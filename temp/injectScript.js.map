{"version":3,"file":"injectScript.js","mappings":"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;AACA;AACA;AACA;;AAEA;AACA,wBAAwB,qBAAM,gBAAgB,qBAAM,IAAI,qBAAM,sBAAsB,qBAAM;;AAE1F;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,GAAG;AACd,WAAW,OAAO;AAClB,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,eAAe;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA,8BAA8B,mBAAmB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,sBAAsB;AACjC,aAAa,QAAQ;AACrB;AACA;AACA,kBAAkB;AAClB;AACA;AACA,WAAW;AACX;AACA;AACA,6BAA6B;AAC7B,CAAC;;AAED;;;;;;;UCtfA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AAMA;AAMA;CAGA;;AACA,IAAMC,cAAc,GAAG,IAAIpJ,2DAAJ,EAAvB;AACA,IAAQqJ,cAAR,GAA2CD,cAA3C,CAAQC,cAAR;AAAA,IAAwBC,cAAxB,GAA2CF,cAA3C,CAAwBE,cAAxB;AACA,IAAMC,iBAAiB,GAAG,IAAI/D,8DAAJ,CAAsBgE,aAAtB,CAA1B;AAEA,IAAMC,cAAc,GAAG,IAAItI,2DAAJ,CAAmBqI,aAAnB,EAAkCH,cAAlC,CAAvB;AACAD,cAAc,CAACM,OAAf;;SAEeF;;;;;qCAAf,WAA6BzG,IAA7B,EAA2C;IACzC;IACA,IAAM4G,MAAM,GAAGd,oDAAY,CAAC9F,IAAD,CAA3B;IACA,IAAI,CAAC4G,MAAL,EAAa;IAEb,IAAMC,KAAK,GAAGN,cAAc,EAA5B;IACA/M,4DAAW,CAACxE,uEAAD,EAA8B;MAAEgL,IAAI,EAAJA,IAAF;MAAQ6G,KAAK,EAALA;IAAR,CAA9B,CAAX;EACD;;;;AAED,SAASE,8BAAT,GAA0C;EACxCL,cAAc,CAACC,OAAf;EACAH,iBAAiB,CAACG,OAAlB;AACD;;AAED,SAASK,+BAAT,GAA2C;EACzCN,cAAc,CAACO,SAAf;EACAT,iBAAiB,CAACS,SAAlB;AACD;;AAED9N,mEAAkB,CAAC;EACjBwB,gCADiB,4CACgByH,KADhB,EACuB;IACtC,OAAOA,KAAK,GACR2E,8BAA8B,EADtB,GAERC,+BAA+B,EAFnC;EAGD,CALgB;EAMjBpM,MANiB,kBAMVwH,KANU,EAMH;IACZ,OAAOsE,cAAc,CAACQ,YAAf,CAA4B9E,KAA5B,CAAP;EACD,CARgB;EASjBnH,sCATiB,kDASsBmH,KATtB,EAS6B;IAC5C,OAAOoE,iBAAiB,CAACvL,sCAAlB,CAAyDmH,KAAzD,CAAP;EACD;AAXgB,CAAD,CAAlB;AAcA/I,gEAAe,CAAC;EACdsB,gCADc,4CACmBwM,CADnB,EACsB/E,KADtB,EAC6B;IACzC,OAAOA,KAAK,GACR2E,8BAA8B,EADtB,GAERC,+BAA+B,EAFnC;EAGD,CALa;EAMdpM,MANc,kBAMPuM,CANO,EAMJ/E,KANI,EAMG;IACf,OAAOsE,cAAc,CAACQ,YAAf,CAA4B9E,KAA5B,CAAP;EACD,CARa;EASdnH,sCATc,kDASyBkM,CATzB,EAS4B/E,KAT5B,EASmC;IAC/C,OAAOoE,iBAAiB,CAACvL,sCAAlB,CAAyDmH,KAAzD,CAAP;EACD;AAXa,CAAD,CAAf,C","sources":["webpack://translator-extensions/./src/configuration/command.ts","webpack://translator-extensions/./src/configuration/index.ts","webpack://translator-extensions/./src/configuration/modelFieldNameMap.ts","webpack://translator-extensions/./src/extensions-api/browserAction.ts","webpack://translator-extensions/./src/extensions-api/commands.ts","webpack://translator-extensions/./src/extensions-api/contextMenus.ts","webpack://translator-extensions/./src/extensions-api/index.ts","webpack://translator-extensions/./src/extensions-api/runtime.ts","webpack://translator-extensions/./src/extensions-api/storage.ts","webpack://translator-extensions/./src/extensions-api/tabs.ts","webpack://translator-extensions/./src/extensions-api/types/index.ts","webpack://translator-extensions/./src/user-operation/CursorListener.ts","webpack://translator-extensions/./src/user-operation/HotKeyListener.ts","webpack://translator-extensions/./src/user-operation/SearchBox.ts","webpack://translator-extensions/./src/user-operation/SelectionListener.ts","webpack://translator-extensions/./src/user-operation/index.ts","webpack://translator-extensions/./src/user-operation/utils/UserSelectHandler.ts","webpack://translator-extensions/./src/user-operation/utils/getRangeFromPoint.ts","webpack://translator-extensions/./src/user-operation/utils/getSelectionText.ts","webpack://translator-extensions/./src/user-operation/utils/index.ts","webpack://translator-extensions/./src/user-operation/utils/isContentEditable.ts","webpack://translator-extensions/./src/user-operation/utils/verifySearchContainer.ts","webpack://translator-extensions/./src/utils/Messenger.ts","webpack://translator-extensions/./src/utils/alert.ts","webpack://translator-extensions/./src/utils/index.ts","webpack://translator-extensions/./src/utils/validateText.ts","webpack://translator-extensions/./node_modules/.pnpm/registry.npmmirror.com+lodash.pick@4.4.0/node_modules/lodash.pick/index.js","webpack://translator-extensions/webpack/bootstrap","webpack://translator-extensions/webpack/runtime/compat get default export","webpack://translator-extensions/webpack/runtime/define property getters","webpack://translator-extensions/webpack/runtime/global","webpack://translator-extensions/webpack/runtime/hasOwnProperty shorthand","webpack://translator-extensions/webpack/runtime/make namespace object","webpack://translator-extensions/./src/inject-script/index.ts"],"sourcesContent":["export enum Command {\r\n  AddNote,\r\n  UpdateNote,\r\n  RelearnNote,\r\n  HistoryIndex,\r\n  TranslateText,\r\n\r\n  PauseAudio,\r\n  ShowTranslation,\r\n  OpenSelection,\r\n  HiddenChinese,\r\n  BackHistory,\r\n  ForwardHistory,\r\n  Callback,\r\n  OpenSearchBox,\r\n  ShowInjectTranslation,\r\n  ShowIframe,\r\n\r\n  GetVersion,\r\n  GetDeckNames,\r\n  GetModelNames,\r\n  GetModelFieldNames,\r\n\r\n  TranslateInjectText,\r\n}\r\n","export {\r\n  WORD_FIELDS_MAP,\r\n  PHRASE_FIELDS_MAP,\r\n  COMMON_CONFIG_MAP,\r\n  SENTENCE_FIELDS_MAP,\r\n  ANKI_CONNECTION_MAP,\r\n} from \"./modelFieldNameMap\";\r\n\r\nexport { Command } from \"./command\";\r\n\r\nexport const DEFAULT_ANKI_CONNECTION_URL = \"http://127.0.0.1:8765\";\r\n","import {\r\n  WordFields,\r\n  PhraseFields,\r\n  CommonConfig,\r\n  SentenceFields,\r\n} from \"@/extensions-api\";\r\n\r\nconst WORD_FIELDS_MAP: WordFields = {\r\n  definition: \"定义\",\r\n  word: \"单词\",\r\n  translation: \"翻译\",\r\n  part_of_speech: \"词性\",\r\n  definition_audio: \"定义音频\",\r\n  am: \"美国音标\",\r\n  en: \"英国音标\",\r\n  am_audio: \"美国音频\",\r\n  en_audio: \"英国音频\",\r\n  star_amount: \"出现频率\",\r\n  example_audio: \"例句音频\",\r\n  example_sentence: \"例句原文\",\r\n  example_sentence_translation: \"例句翻译\",\r\n};\r\n\r\nconst PHRASE_FIELDS_MAP: PhraseFields = {\r\n  phrase: \"短语词组\",\r\n  phrase_audio: \"短语音频\",\r\n  translations: \"短语翻译\",\r\n  example_audio_1: \"例句1音频\",\r\n  example_audio_2: \"例句2音频\",\r\n  example_audio_3: \"例句3音频\",\r\n  example_sentence_1: \"例句1原文\",\r\n  example_sentence_2: \"例句2原文\",\r\n  example_sentence_3: \"例句3原文\",\r\n  example_sentence_translation_1: \"例句1翻译\",\r\n  example_sentence_translation_2: \"例句2翻译\",\r\n  example_sentence_translation_3: \"例句3翻译\",\r\n};\r\n\r\nconst SENTENCE_FIELDS_MAP: SentenceFields = {\r\n  sentence: \"句子原文\",\r\n  sentence_audio: \"句子音频\",\r\n  sentence_translation: \"句子翻译\",\r\n};\r\n\r\nconst COMMON_CONFIG_MAP: CommonConfig = {\r\n  deckName: \"牌组名称\",\r\n  modelName: \"模型名称\",\r\n  tags: \"卡片标签\",\r\n};\r\n\r\nconst ANKI_CONNECTION_MAP = {\r\n  ankiConnectionMethod: \"连接方法\",\r\n  ankiConnectionURL: \"连接URL\",\r\n};\r\n\r\nif (__DEV__) {\r\n  Object.freeze(WORD_FIELDS_MAP);\r\n  Object.freeze(PHRASE_FIELDS_MAP);\r\n  Object.freeze(SENTENCE_FIELDS_MAP);\r\n  Object.freeze(COMMON_CONFIG_MAP);\r\n  Object.freeze(ANKI_CONNECTION_MAP);\r\n}\r\n\r\nexport {\r\n  WORD_FIELDS_MAP,\r\n  COMMON_CONFIG_MAP,\r\n  PHRASE_FIELDS_MAP,\r\n  SENTENCE_FIELDS_MAP,\r\n  ANKI_CONNECTION_MAP,\r\n};\r\n","export function setBadgeText(\r\n  details: chrome.browserAction.BadgeTextDetails,\r\n  callback?: () => void\r\n) {\r\n  chrome.browserAction.setBadgeText(details, callback);\r\n}\r\n","//此处的值与 manifest 中 command对象的键相关\r\ntype Command =\r\n  | \"open_search_box\"\r\n  | \"show_translation_page\"\r\n  | \"switch_hotkey_and_selection_listener\";\r\n\r\ntype HandlerObject = Record<Command, () => void>;\r\nlet onCommand = function onCommand(handlerObject: HandlerObject) {\r\n  //监听用户快捷键，用于开关拓展\r\n  chrome.commands.onCommand.addListener(function (command) {\r\n    const handler = handlerObject[command as Command];\r\n    handler?.();\r\n  });\r\n};\r\n\r\nif (__DEV__) {\r\n  onCommand = function StrictOnCommand(handlerObject: HandlerObject) {\r\n    const { commands } = chrome.runtime.getManifest();\r\n    if (!commands) throw new Error(\"manifest.json 文件中没有 commands 项\");\r\n    const commandNames = Object.keys(handlerObject);\r\n    commandNames.forEach(function (command) {\r\n      if (!(command in commands))\r\n        throw new Error(`没有在 commands 中找到 ${command} 项`);\r\n    });\r\n    //监听用户快捷键，用于开关拓展\r\n    chrome.commands.onCommand.addListener(function (command) {\r\n      const handler = handlerObject[command as Command];\r\n      handler?.();\r\n    });\r\n  };\r\n}\r\n\r\nexport { onCommand };\r\n","export function addContextMenuItem(\r\n  createProperties: chrome.contextMenus.CreateProperties,\r\n  callback?: () => void\r\n) {\r\n  chrome.contextMenus.create(createProperties, callback);\r\n}\r\n\r\nexport function onContextMenuClick(\r\n  callback: (\r\n    info: chrome.contextMenus.OnClickData,\r\n    tab?: chrome.tabs.Tab\r\n  ) => void\r\n) {\r\n  chrome.contextMenus.onClicked.addListener(callback);\r\n}\r\n","export {\r\n  getStorageByArray,\r\n  getStorageByObject,\r\n  setStorage,\r\n  onStorageChange,\r\n} from \"./storage\";\r\n\r\nexport { onCommand } from \"./commands\";\r\nexport { setBadgeText } from \"./browserAction\";\r\nexport { executeScript, postFrontend } from \"./tabs\";\r\nexport { addContextMenuItem, onContextMenuClick } from \"./contextMenus\";\r\nexport { postBackend, onMessage, getURL, openOptionsPage } from \"./runtime\";\r\nexport { TabPanelName } from \"./types\";\r\nexport type {\r\n  Storage,\r\n  WordFields,\r\n  ModelFields,\r\n  PhraseFields,\r\n  SentenceFields,\r\n  WordConfig,\r\n  PhraseConfig,\r\n  CommonConfig,\r\n  SentenceConfig,\r\n  CheckWordDuplicate,\r\n  CheckPhraseDuplicate,\r\n  CheckSentenceDuplicate,\r\n  ConfigKeys,\r\n  DuplicateConfigKeys,\r\n} from \"./types\";\r\n","import { Command } from \"@/configuration\";\r\nimport { ShowData, Point } from \"@/types\";\r\nimport { NoteData } from \"@/translation-page\";\r\nimport {\r\n  AddNoteReturnType,\r\n  GetVersionReturnType,\r\n  RelearnCardsReturnType,\r\n  GetDeckNamesReturnType,\r\n  GetModelNamesReturnType,\r\n  GetModelFieldNamesReturnType,\r\n} from \"@/anki\";\r\nimport { TranslationResult } from \"@/dictionary\";\r\nexport function getURL(name: string) {\r\n  return chrome.runtime.getURL(name);\r\n}\r\n\r\nexport function openOptionsPage(callback?: () => void) {\r\n  chrome.runtime.openOptionsPage(callback);\r\n}\r\n\r\nexport type SendResponse = Parameters<\r\n  Parameters<typeof chrome.runtime.onMessage.addListener>[\"0\"]\r\n>[\"2\"];\r\n\r\n//向后端发送消息的函数\r\nexport async function postBackend(\r\n  command: Command.GetDeckNames\r\n): Promise<GetDeckNamesReturnType>;\r\nexport async function postBackend(\r\n  command: Command.GetModelNames\r\n): Promise<GetModelNamesReturnType>;\r\nexport async function postBackend(\r\n  command: Command.GetVersion\r\n): Promise<GetVersionReturnType>;\r\nexport async function postBackend(\r\n  command: Command.GetModelFieldNames,\r\n  data: string\r\n): Promise<GetModelFieldNamesReturnType>;\r\nexport async function postBackend(\r\n  command: Command.AddNote,\r\n  data: NoteData\r\n): Promise<AddNoteReturnType>;\r\nexport async function postBackend(\r\n  command: Command.RelearnNote,\r\n  data: number[]\r\n): Promise<RelearnCardsReturnType>;\r\nexport async function postBackend(\r\n  command: Command.TranslateText,\r\n  data: string\r\n): Promise<TranslationResult>;\r\nexport async function postBackend(\r\n  command: Command.TranslateInjectText,\r\n  data: { text: string; point: Point }\r\n): Promise<void>;\r\nexport async function postBackend(command: Command, data?: any): Promise<any> {\r\n  return new Promise((resolve) => {\r\n    chrome.runtime.sendMessage({ command, data }, function (response) {\r\n      resolve(response);\r\n    });\r\n  });\r\n}\r\n\r\ninterface Handler {\r\n  (args: {\r\n    command: Command.ShowInjectTranslation;\r\n    data: Required<ShowData>;\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.TranslateInjectText;\r\n    data: { text: string; point: Point };\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.OpenSearchBox;\r\n    data: undefined;\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.ShowIframe;\r\n    data: undefined;\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetVersion;\r\n    data: undefined;\r\n    sendResponse: (data: GetVersionReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetDeckNames;\r\n    data: undefined;\r\n    sendResponse: (data: GetDeckNamesReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetModelNames;\r\n    data: undefined;\r\n    sendResponse: (data: GetModelNamesReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetModelFieldNames;\r\n    data: string;\r\n    sendResponse: (data: GetModelFieldNamesReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.AddNote;\r\n    data: NoteData;\r\n    sendResponse: (data: AddNoteReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.RelearnNote;\r\n    data: number[];\r\n    sendResponse: (data: RelearnCardsReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.TranslateText;\r\n    data: string;\r\n    sendResponse: (data: TranslationResult) => void;\r\n  }): Promise<void>;\r\n}\r\n//监听拓展不同模块间消息传递的函数\r\nexport function onMessage(handler: Handler) {\r\n  chrome.runtime.onMessage.addListener(function (\r\n    message,\r\n    sender,\r\n    _sendResponse\r\n  ) {\r\n    //主要用于消除因为 return true,但却没有调用 sendResponse 而造成的报错。\r\n    let called = false;\r\n    handler({\r\n      ...message,\r\n      sendResponse(...args: any[]) {\r\n        called = true;\r\n        return _sendResponse(...args);\r\n      },\r\n    }).then(function () {\r\n      if (called) return;\r\n\r\n      _sendResponse();\r\n    });\r\n    return true; //为了使sendResponse可以异步调用，这是必须的\r\n  });\r\n}\r\n","import pick from \"lodash.pick\";\r\nimport { DEFAULT_ANKI_CONNECTION_URL } from \"@/configuration\";\r\nimport { Storage, TabPanelName, PartialStorage } from \"./types\";\r\n\r\n//缓存默认值对象，用于在用户刚刚加载拓展，没有进行任何配置时作为初始配置。\r\n//确保 Storage 中的缓存无论何时都是符合要求的，不存在刚刚加载插件时因为 Storage 为空而导致的问题。\r\nconst defaultStorage: Storage = {\r\n  switchHotkeyAndSelectionListener: true,\r\n  hotKey: \"shiftKey\",\r\n  openSelection: true,\r\n  hiddenChinese: false,\r\n  checkedTabPanel: TabPanelName.Home,\r\n  ankiConnectionMethod: \"AnkiConnection\",\r\n  ankiConnectionURL: DEFAULT_ANKI_CONNECTION_URL,\r\n  switchStrengthenSelectionByPressedCtrl: true,\r\n  wordConfig: {},\r\n  phraseConfig: {},\r\n  sentenceConfig: {},\r\n\r\n  checkWordDuplicate: {\r\n    word: true,\r\n    deckName: true,\r\n    definition: true,\r\n    translation: true,\r\n  },\r\n  checkPhraseDuplicate: {\r\n    phrase: true,\r\n    deckName: true,\r\n  },\r\n  checkSentenceDuplicate: {\r\n    deckName: true,\r\n    sentence: true,\r\n  },\r\n};\r\n\r\ntype StorageKeys = keyof Storage;\r\n\r\ntype StorageHandlers<T extends PartialStorage> = {\r\n  [P in keyof T]?: (value: T[P]) => void;\r\n};\r\n\r\ntype StorageToCallback<T extends PartialStorage> = {\r\n  [P in keyof T]?: (oldVal: T[P], newVal: T[P]) => void;\r\n};\r\n\r\ntype GetStorageCallback = (storage: PartialStorage) => void;\r\n\r\nfunction handlersIsArray(\r\n  handlers: StorageHandlers<Storage> | StorageKeys[]\r\n): handlers is StorageKeys[] {\r\n  return Array.isArray(handlers);\r\n}\r\n\r\nfunction getStorage<K extends StorageKeys>(\r\n  handlers: K[],\r\n  callback: (storage: Pick<Storage, K>) => void\r\n): void;\r\nfunction getStorage(\r\n  handlers: StorageHandlers<Storage>,\r\n  callback?: GetStorageCallback\r\n): void;\r\nfunction getStorage<K extends StorageKeys>(\r\n  handlers: StorageHandlers<Storage> | K[],\r\n  callback?: (storage: Pick<Storage, K>) => void\r\n) {\r\n  const storageKeys = handlersIsArray(handlers)\r\n    ? handlers\r\n    : (Object.keys(handlers) as StorageKeys[]);\r\n  const storage = pick(defaultStorage, storageKeys);\r\n  chrome.storage.local.get(storage, (storage: PartialStorage) => {\r\n    if (!handlersIsArray(handlers)) {\r\n      Object.keys(storage).forEach((key) => {\r\n        const handler = handlers[key as StorageKeys];\r\n        const cacheValue = storage[key as StorageKeys];\r\n        //@ts-ignore 是匹配的值\r\n        handler?.(cacheValue);\r\n      });\r\n    }\r\n    callback?.(storage as Pick<Storage, K>);\r\n  });\r\n}\r\n\r\nexport function getStorageByArray<K extends StorageKeys>(\r\n  names: K[],\r\n  callback: (storage: Pick<Storage, K>) => void\r\n) {\r\n  getStorage(names, callback);\r\n}\r\n\r\nexport function getStorageByObject(\r\n  handlers: StorageHandlers<Storage>,\r\n  callback?: GetStorageCallback\r\n) {\r\n  getStorage(handlers, callback);\r\n}\r\n\r\nexport function onStorageChange(handlers: StorageToCallback<Storage>) {\r\n  const listener: Parameters<typeof chrome.storage.onChanged.addListener>[0] = (\r\n    changes\r\n  ) => {\r\n    Object.keys(changes).forEach((key) => {\r\n      const handler = handlers[key as StorageKeys];\r\n      if (handler) {\r\n        const { oldValue, newValue } = changes[key]!;\r\n        //@ts-ignore 是正确匹配的\r\n        handler(oldValue, newValue);\r\n      }\r\n    });\r\n  };\r\n  chrome.storage.onChanged.addListener(listener);\r\n  return () => {\r\n    chrome.storage.onChanged.removeListener(listener);\r\n  };\r\n}\r\n\r\nexport function setStorage(\r\n  partialStorage: PartialStorage,\r\n  callback?: () => void\r\n) {\r\n  chrome.storage.local.set(partialStorage, callback);\r\n}\r\n","import { ShowData } from \"@/types\";\r\nimport { Command } from \"@/configuration\";\r\n\r\n//向前端发送消息的函数\r\nexport async function postFrontend(command: Command.ShowIframe): Promise<void>;\r\nexport async function postFrontend(\r\n  command: Command.OpenSearchBox\r\n): Promise<void>;\r\nexport async function postFrontend(\r\n  command: Command.ShowInjectTranslation,\r\n  data: Required<ShowData>\r\n): Promise<void>;\r\nexport async function postFrontend(\r\n  command: Command,\r\n  data?: any\r\n): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    chrome.tabs.query({ active: true }, function (tabs) {\r\n      tabs.forEach((tab) => {\r\n        if (!tab.id) return;\r\n        chrome.tabs.sendMessage(tab.id, { command, data }, function (response) {\r\n          resolve(response);\r\n        });\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nexport function executeScript(\r\n  details: chrome.tabs.InjectDetails,\r\n  callback?: ((result: any[]) => void) | undefined\r\n) {\r\n  chrome.tabs.executeScript(details, callback);\r\n}\r\n","import { HotKey } from \"@/types\";\r\n\r\nexport interface CommonConfig {\r\n  tags: string;\r\n  deckName: string;\r\n  modelName: string;\r\n}\r\n\r\nexport interface WordFields {\r\n  en: string;\r\n  am: string;\r\n  word: string;\r\n  am_audio: string;\r\n  en_audio: string;\r\n  definition: string;\r\n  translation: string;\r\n  star_amount: string;\r\n  example_audio: string;\r\n  part_of_speech: string;\r\n  definition_audio: string;\r\n  example_sentence: string;\r\n  example_sentence_translation: string;\r\n}\r\n\r\nexport interface PhraseFields {\r\n  phrase: string;\r\n  phrase_audio: string;\r\n  translations: string;\r\n  example_audio_1: string;\r\n  example_audio_2: string;\r\n  example_audio_3: string;\r\n  example_sentence_1: string;\r\n  example_sentence_2: string;\r\n  example_sentence_3: string;\r\n  example_sentence_translation_1: string;\r\n  example_sentence_translation_2: string;\r\n  example_sentence_translation_3: string;\r\n}\r\n\r\nexport interface SentenceFields {\r\n  sentence: string;\r\n  sentence_audio: string;\r\n  sentence_translation: string;\r\n}\r\n\r\nexport const enum TabPanelName {\r\n  Home,\r\n  Word,\r\n  Phrase,\r\n  Sentence,\r\n}\r\n\r\nexport type WordConfig = Partial<WordFields & CommonConfig>;\r\nexport type PhraseConfig = Partial<PhraseFields & CommonConfig>;\r\nexport type SentenceConfig = Partial<SentenceFields & CommonConfig>;\r\nexport type ConfigKeys =\r\n  | keyof WordConfig\r\n  | keyof PhraseConfig\r\n  | keyof SentenceConfig;\r\n\r\nexport type CheckWordDuplicate = Partial<\r\n  Record<keyof Omit<WordConfig, \"tags\">, boolean>\r\n>;\r\nexport type CheckPhraseDuplicate = Partial<\r\n  Record<keyof Omit<PhraseConfig, \"tags\">, boolean>\r\n>;\r\nexport type CheckSentenceDuplicate = Partial<\r\n  Record<keyof Omit<SentenceConfig, \"tags\">, boolean>\r\n>;\r\n\r\nexport type DuplicateConfigKeys =\r\n  | keyof CheckWordDuplicate\r\n  | keyof CheckPhraseDuplicate\r\n  | keyof CheckSentenceDuplicate;\r\n\r\nexport type ModelFields =\r\n  | Partial<WordFields>\r\n  | Partial<PhraseFields>\r\n  | Partial<SentenceFields>;\r\n\r\nexport interface Storage {\r\n  switchHotkeyAndSelectionListener: boolean;\r\n  openSelection: boolean;\r\n  hiddenChinese: boolean;\r\n  ankiConnectionURL: string;\r\n  hotKey: HotKey;\r\n  ankiConnectionMethod: string;\r\n  checkedTabPanel: TabPanelName;\r\n  wordConfig: WordConfig;\r\n  phraseConfig: PhraseConfig;\r\n  sentenceConfig: SentenceConfig;\r\n  checkWordDuplicate: CheckWordDuplicate;\r\n  checkPhraseDuplicate: CheckPhraseDuplicate;\r\n  checkSentenceDuplicate: CheckSentenceDuplicate;\r\n  switchStrengthenSelectionByPressedCtrl: boolean;\r\n}\r\n\r\nexport type PartialStorage = Partial<Storage>;\r\n","import type { Point } from \"@/types\";\r\n\r\nexport class CursorListener {\r\n  private clientPoint:Point = { x: 0, y: 0 }\r\n  private screenPoint:Point = { x: 0, y: 0 }\r\n  getClientPoint = () => {\r\n    return this.clientPoint;\r\n  }\r\n  getScreenPoint = () => {\r\n    return this.screenPoint;\r\n  }\r\n  install = () => {\r\n    document.addEventListener(\"mousemove\", this.onMouseMove, true); //避免被阻止冒泡导致失效\r\n  }\r\n  uninstall = () => {\r\n    document.removeEventListener(\"mousemove\", this.onMouseMove, true);\r\n  }\r\n  private onMouseMove = (event: MouseEvent) => {\r\n    const { clientX, clientY, screenY, screenX } = event;\r\n    this.clientPoint = {\r\n      x: clientX,\r\n      y: clientY,\r\n    };\r\n    this.screenPoint = {\r\n      x: screenX,\r\n      y: screenY,\r\n    };\r\n  }\r\n}\r\n","import {\r\n  getSelectionText,\r\n  getRangeFromPoint,\r\n  isContentEditable,\r\n  isSearchContainer,\r\n  UserSelectHandler,\r\n} from \"./utils\";\r\nimport type { HotKey, TranslateAndDisplayText, GetPoint } from \"@/types\";\r\n\r\nexport class HotKeyListener {\r\n  modify;\r\n  restore;\r\n  private hotKey?: HotKey;\r\n  private checkout: RegExp;\r\n  private getPoint: GetPoint;\r\n  private translateAndDisplayText: TranslateAndDisplayText;\r\n\r\n  constructor(\r\n    translateAndDisplayText: TranslateAndDisplayText,\r\n    getPoint: GetPoint\r\n  ) {\r\n    this.getPoint = getPoint;\r\n    this.translateAndDisplayText = translateAndDisplayText;\r\n    this.hotKey = \"shiftKey\";\r\n    this.checkout = /[a-z_]/i;\r\n\r\n    const { modify, restore } = new UserSelectHandler();\r\n    this.modify = modify;\r\n    this.restore = restore;\r\n  }\r\n\r\n  updateHotKey = (hotKey: HotKey | undefined) => {\r\n    this.hotKey = hotKey;\r\n  };\r\n\r\n  install = () => {\r\n    document.addEventListener(\"keydown\", this.onKeyDown);\r\n  };\r\n  uninstall = () => {\r\n    document.removeEventListener(\"keydown\", this.onKeyDown);\r\n    this.restore();\r\n  };\r\n\r\n  private onKeyDown = (event: KeyboardEvent) => {\r\n    const { hotKey } = this;\r\n\r\n    if (hotKey && event[hotKey]) {\r\n      //当焦点在可输入元素上，不进行热键选词\r\n      const focusNode = document.activeElement;\r\n      if (focusNode && isContentEditable(focusNode)) return;\r\n      //这是一个用 div 封装的 input\r\n      if (isSearchContainer(focusNode)) return;\r\n\r\n      const { x, y } = this.getPoint();\r\n      this.autoSelectText(x, y);\r\n      const selectedText = getSelectionText();\r\n      if (!selectedText) return;\r\n      this.translateAndDisplayText(selectedText);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 判断是否符合自动选中条件\r\n   * @param letter 当前需要判断的字母\r\n   * @returns Boolean\r\n   */\r\n  private validate = (letter: string) => {\r\n    if (letter == null) return false;\r\n    return this.checkout.test(letter);\r\n  };\r\n\r\n  /**\r\n   * 根据用户鼠标的当前位置，自动选中符合要求的文本，表现为对应文本拖蓝选中\r\n   * @param x ClientX\r\n   * @param y ClientY\r\n   * @returns\r\n   */\r\n  private autoSelectText = (x: number, y: number) => {\r\n    let range = getRangeFromPoint(x, y);\r\n    if (!range) return;\r\n\r\n    range = this.extendRange(range);\r\n    if (range == null) return;\r\n\r\n    const selection = getSelection();\r\n    if (!selection) return;\r\n\r\n    //避免因为 user-select:none 而导致 热键选中失效\r\n    const target = range.commonAncestorContainer.parentElement;\r\n    if (target != null) {\r\n      this.modify(target);\r\n    }\r\n\r\n    //只有 firefox支持多个拖蓝选中，而其它浏览器不支持，因此如果不先清空原有的range，则后面的添加无效\r\n    selection.removeAllRanges();\r\n    //用拖蓝形式展现被选中的单词\r\n    selection.addRange(range);\r\n  };\r\n\r\n  /**\r\n   * 传入一个 选中文本节点 的 Range对象，\r\n   * 按照一定要求对其进行扩充，\r\n   * 返回一个新的Range\r\n   *\r\n   * @param range Range\r\n   * @returns Range\r\n   */\r\n  private extendRange = (range: Range): Range | null => {\r\n    const textNode = range.startContainer;\r\n    //并非文本节点，退出\r\n    if (!isText(textNode)) return null;\r\n    const limit_left = 0;\r\n    const limit_right = textNode.length;\r\n    const text = textNode.data;\r\n    let { startOffset, endOffset } = range;\r\n\r\n    //如果当前鼠标位置的字符不符合要求，则表明无需进行自动选取\r\n    if (!this.validate(text[startOffset])) return range;\r\n\r\n    while (limit_left <= startOffset) {\r\n      const letter = text[startOffset];\r\n      if (this.validate(letter)) {\r\n        startOffset--;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    //回退到前一个符合要求的字符\r\n    startOffset++;\r\n    //startOffset与endOffset在一开始是相等的，避免重复验证同一个字符\r\n    endOffset++;\r\n    while (endOffset < limit_right) {\r\n      const letter = text[endOffset];\r\n\r\n      if (this.validate(letter)) {\r\n        endOffset++;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    //因为setEnd不包括endOffset，因此不用回退到上一个符合要求的字符\r\n    //但需要注意，避免endOffset超出limit_right\r\n    endOffset = Math.min(limit_right, endOffset);\r\n    const newRange = new Range();\r\n    newRange.setStart(textNode, startOffset);\r\n    newRange.setEnd(textNode, endOffset);\r\n    return newRange;\r\n  };\r\n}\r\n\r\nfunction isText(node: Node): node is Text {\r\n  return node.nodeType === 3;\r\n}\r\n","/**\r\n * 允许用户通过搜索栏主动输入单词，而后对单词进行查询\r\n */\r\nimport { attachSymbolToSearchContainer } from \"./utils\";\r\nimport type { TranslateAndDisplayText } from \"@/types\";\r\n\r\nexport class SearchBox {\r\n  openSearchBox;\r\n  closeSearchBox;\r\n  private container;\r\n\r\n  constructor(translateAndDisplayText: TranslateAndDisplayText) {\r\n    const { container, openSearchBox, closeSearchBox } = createSearchBar(\r\n      translateAndDisplayText\r\n    );\r\n    this.container = container;\r\n    this.openSearchBox = openSearchBox;\r\n    this.closeSearchBox = closeSearchBox\r\n  }\r\n  install = () => {\r\n    document.body.append(this.container);\r\n  };\r\n  uninstall = () => {\r\n    this.closeSearchBox()\r\n    this.container.remove();\r\n  }\r\n}\r\n\r\nconst FORM_ID = \"search-form\";\r\nconst INPUT_ID = \"search-input\";\r\nconst BUTTON_ID = \"search-button\";\r\n/**\r\n * 创建搜索条\r\n */\r\nfunction createSearchBar(translateAndDisplayText: TranslateAndDisplayText) {\r\n  const container = document.createElement(\"div\");\r\n  attachSymbolToSearchContainer(container);\r\n  //实现幽灵节点\r\n  container.style.setProperty(\"display\", \"contents\", \"important\");\r\n  const shadow = container.attachShadow({\r\n    mode: \"open\",\r\n  });\r\n  shadow.innerHTML = `\r\n    <style>\r\n      #${FORM_ID} {\r\n        display:none;\r\n        box-sizing: border-box;\r\n        position: fixed;\r\n        z-index: 99999;\r\n        left: 50%;     \r\n        right: 0;       \r\n        top: 10vh;\r\n        margin: auto;\r\n        min-width: 200px;\r\n        width: 25%;\r\n        border: 1px solid #666;\r\n        border-radius: 5px;\r\n        background:white;\r\n        box-shadow: 1px 1px 2px -1px #333;\r\n      }\r\n      #${INPUT_ID} {\r\n        flex: 1;\r\n        box-sizing: border-box;\r\n        width: 100%;\r\n        border: none;\r\n        border-radius: 5px 0 0 5px;\r\n        padding: 0 10px;\r\n        outline: none;\r\n        font-size: 16px;\r\n        line-height: 2;\r\n      }\r\n      #${BUTTON_ID} {\r\n        font-size: 28px;\r\n        line-height: 1;\r\n        border: none;\r\n        border-radius: 0 5px 5px 0;\r\n        background: white;\r\n        outline:none;\r\n      }\r\n      #${BUTTON_ID}:hover,\r\n      #${BUTTON_ID}:focus {\r\n        background: #e6e6e6;\r\n      }\r\n      .vertical {\r\n        width: 1px;\r\n        background: #666;\r\n        margin: 3px 0;\r\n      }\r\n    </style>    \r\n    <form action=\"#\" autocomplete=\"off\" id=\"${FORM_ID}\">\r\n      <input type=\"text\" id=\"${INPUT_ID}\"/>\r\n      <span class=\"vertical\"></span>\r\n      <button type=\"button\" id=\"${BUTTON_ID}\">×</button>\r\n    </form>\r\n  `;\r\n  const form = shadow.getElementById(FORM_ID) as HTMLFormElement;\r\n  const input = shadow.getElementById(INPUT_ID) as HTMLInputElement;\r\n  const button = shadow.getElementById(BUTTON_ID) as HTMLButtonElement;\r\n  //绑定事件监听\r\n  //当用户按下enter键时进行查询\r\n  form.addEventListener(\"submit\", function (event) {\r\n    event.preventDefault();\r\n    var text = input.value.trim();\r\n    if (text) {\r\n      translateAndDisplayText(text);\r\n    }\r\n  });\r\n\r\n  button.addEventListener(\"click\", closeSearchBox);\r\n\r\n  function closeSearchBox() {\r\n    input.value = \"\";\r\n    form.style.display = \"none\";\r\n  }\r\n\r\n  function openSearchBox() {\r\n    form.style.display = \"flex\";\r\n    input.focus();\r\n    input.select();\r\n  }\r\n\r\n  return {\r\n    container,\r\n    openSearchBox,\r\n    closeSearchBox,\r\n  };\r\n}\r\n","/**\r\n * 双击选中翻译事件\r\n */\r\nimport {\r\n  getSelectionText,\r\n  isContentEditable,\r\n  isSearchContainer,\r\n} from \"./utils\";\r\n\r\nimport type{ TranslateAndDisplayText } from \"@/types\";\r\n\r\nexport class SelectionListener {\r\n  private enableCtrl = true;\r\n  private selectionChanged = false;\r\n  private translateAndDisplayText: TranslateAndDisplayText;\r\n\r\n  constructor(translateAndDisplayText: TranslateAndDisplayText) {\r\n    this.translateAndDisplayText = translateAndDisplayText;\r\n  }\r\n\r\n  install = () => {\r\n    document.addEventListener(\"mousedown\", this.onMouseDown);\r\n    document.addEventListener(\"mouseup\", this.onMouseUp);\r\n  };\r\n  uninstall = () => {\r\n    document.removeEventListener(\"mousedown\", this.onMouseDown);\r\n    document.removeEventListener(\"mouseup\", this.onMouseUp);\r\n  };\r\n\r\n  /**\r\n   * @param value true,使得用户能够在按住 Ctrl键进行选取时，可以翻译 可输入元素内部的文本，false则是不可以\r\n   */\r\n  switchStrengthenSelectionByPressedCtrl = (value: boolean) =>{\r\n    this.enableCtrl = value;\r\n  }\r\n\r\n  private onMouseDown = () => {\r\n    document.addEventListener(\"selectionchange\", this.onSelectionChange, {\r\n      once: true,\r\n    });\r\n  };\r\n\r\n  private onSelectionChange = () => {\r\n    this.selectionChanged = true;\r\n  };\r\n\r\n  /**\r\n   * 当用户拖蓝选取文本时，鼠标抬起是进行查询的时间\r\n   * 当用户双击选取文本时，鼠标抬起也是进行查询的时机\r\n   * @returns void\r\n   */\r\n  private onMouseUp = (event: MouseEvent) => {\r\n    if (!this.selectionChanged) {\r\n      document.removeEventListener(\"selectionchange\", this.onSelectionChange);\r\n      return;\r\n    }\r\n\r\n    this.selectionChanged = false;\r\n    const selectedText = getSelectionText();\r\n    if (!selectedText) return;\r\n\r\n    const hotKey = event.ctrlKey;\r\n    const focusNode = document.activeElement;\r\n    //判断是否跳过对于可编辑元素的过滤\r\n    if (!(this.enableCtrl && hotKey)) {\r\n      //不对输入框中的文本进行选中翻译\r\n      if (focusNode && isContentEditable(focusNode)) return;\r\n    }\r\n    if (isSearchContainer(focusNode)) return;\r\n\r\n    this.translateAndDisplayText(selectedText);\r\n  };\r\n}\r\n","export { SearchBox } from \"./SearchBox\";//创建一个搜索框，允许用户搜索\r\nexport { CursorListener } from \"./CursorListener\";//实时监听鼠标位置\r\nexport { HotKeyListener } from \"./HotKeyListener\";//监听用户热键选词翻译的操作\r\nexport { SelectionListener } from \"./SelectionListener\";//监听用户双击、拖蓝选中翻译的操作\r\n","const USER_SELECT = \"user-select\";\r\n\r\nexport class UserSelectHandler {\r\n  modifiedHTMLElements: Map<HTMLElement, [string, string]> = new Map();\r\n  modify = (element: HTMLElement) => {\r\n    const modifiedHTMLElements = this.modifiedHTMLElements;\r\n    if (!modifiedHTMLElements.has(element)) {\r\n      var userSelectValue = element.style.getPropertyValue(USER_SELECT);\r\n      var userSelectPriority = element.style.getPropertyPriority(USER_SELECT);\r\n      modifiedHTMLElements.set(element, [userSelectValue, userSelectPriority]);\r\n      element.style.setProperty(USER_SELECT, \"text\", \"important\");\r\n    }\r\n  };\r\n  restore = () => {\r\n    const modifiedHTMLElements = this.modifiedHTMLElements;\r\n    modifiedHTMLElements.forEach(function ([value, priority], element) {\r\n      element.style.setProperty(USER_SELECT, value, priority);\r\n    });\r\n    modifiedHTMLElements.clear();\r\n  };\r\n}\r\n\r\n","/**\r\n * 对 document.caretPositionFromPoint/caretRangeFromPoint 进行浏览器兼容处理\r\n * @param x clientX\r\n * @param y clientY\r\n * @returns Range\r\n */\r\n export function getRangeFromPoint(x: number, y: number): Range | null {\r\n  if (\"caretRangeFromPoint\" in document) {\r\n    return document.caretRangeFromPoint(x, y)\r\n  }\r\n\r\n  if (\"caretPositionFromPoint\" in document) {\r\n    //@ts-ignore 该方法存在于firefox\r\n    let caretPosition = document.caretPositionFromPoint(x, y)\r\n    if (!caretPosition) return null\r\n    let { offsetNode, offset } = caretPosition\r\n    let range = document.createRange()\r\n    range.setStart(offsetNode, offset)\r\n    return range\r\n  }\r\n  if (__DEV__) {\r\n    throw new Error(\"没有在 document 上找到 'caretPositionFromPoint' 或者 'caretRangeFromPoint' 方法，无法实现热键选中功能。\")\r\n  }\r\n  return null\r\n}","export function getSelectionText(): string | undefined {\r\n  let selection = getSelection()\r\n  return selection?.toString().trim()\r\n}","export { getSelectionText } from \"./getSelectionText\";\r\nexport { getRangeFromPoint } from \"./getRangeFromPoint\";\r\nexport { isContentEditable } from \"./isContentEditable\";\r\nexport { UserSelectHandler } from \"./UserSelectHandler\";\r\nexport {\r\n  isSearchContainer,\r\n  attachSymbolToSearchContainer,\r\n} from \"./verifySearchContainer\";\r\n","export function isContentEditable(element:Element) {\r\n  if ([\"INPUT\", \"TEXTAREA\"].includes(element.tagName)) return true;\r\n  if (element instanceof HTMLElement && element.isContentEditable) return true;\r\n  return false;\r\n}","const SEARCH_CONTAINER_ID = \"ANKI_BROWSER_EXTENSIONS_SEARCH_CONTAINER_ID\";\r\nconst ATTRIBUTE_NAME = \"ANKI_BROWSER_EXTENSIONS_SEARCH_CONTAINER_ATTRIBUTE_NAME\"\r\n\r\nexport function isSearchContainer(element:unknown) {\r\n  if (element == null) return false;\r\n  if (!(element instanceof HTMLElement)) return false\r\n  return element.getAttribute(ATTRIBUTE_NAME) === SEARCH_CONTAINER_ID;\r\n}\r\n\r\nexport function attachSymbolToSearchContainer(element:Element) {\r\n  element.setAttribute(ATTRIBUTE_NAME, SEARCH_CONTAINER_ID);\r\n}","/**\r\n * 对 window.addEventListener(\"message\",callback) 与 window.postMessage 进行二次封装，\r\n *  使window.postMessage具备回调函数功能\r\n */\r\n\r\nimport { FunctionAny } from \"@/types\";\r\nimport { Command } from \"@/configuration\";\r\nimport { warning, invariant } from \"@/utils\";\r\nimport { NoteData } from \"@/translation-page\";\r\nimport { TranslationResult } from \"@/dictionary\";\r\nimport { AddNoteReturnType, RelearnCardsReturnType } from \"@/anki\";\r\n\r\nlet uniqueId = 1;\r\nconst CALLBACK = \"CALLBACK\";\r\n\r\ninterface MessageData {\r\n  command: Command;\r\n  //可选\r\n  data?: any;\r\n  callbackName?: number;\r\n}\r\nexport type PostMessage = Messenger[\"postMessage\"];\r\nexport type OnMessage = Messenger[\"onMessage\"];\r\nexport class Messenger {\r\n  target?: Window;\r\n  self: Window;\r\n  callbacks: { [key: number]: FunctionAny };\r\n  handlers: { [key: string]: FunctionAny[] };\r\n\r\n  constructor(options: { self: Window; target?: Window }) {\r\n    this.self = options.self;\r\n    this.target = options.target;\r\n    this.handlers = Object.create(null);\r\n    this.callbacks = Object.create(null);\r\n    this.onMessage = this.onMessage.bind(this);\r\n    this.postMessage = this.postMessage.bind(this);\r\n  }\r\n  install = () => {\r\n    const { self } = this;\r\n    self.addEventListener(\"message\", this.handleMessage);\r\n  };\r\n  uninstall = () => {\r\n    const { self } = this;\r\n    self.removeEventListener(\"message\", this.handleMessage);\r\n  };\r\n  addTarget = (target: Window) => {\r\n    this.target = target;\r\n  };\r\n  handleMessage = (event: MessageEvent<MessageData>) => {\r\n    const { target, handlers, callbacks } = this;\r\n    const source = event.source;\r\n    const { data, command, callbackName } = event.data;\r\n    if (target !== source) return;\r\n    const callback = callbackName == null ? null : callbacks[callbackName]; // 注释一\r\n    //执行回调专用指令(回调函数响应)\r\n    //@ts-ignore 内部使用，不对外暴露\r\n    if (command === CALLBACK && callback == null) return;\r\n    //@ts-ignore 内部使用，不对外暴露\r\n    if (command === CALLBACK && callback) {\r\n      callback(data);\r\n      //@ts-ignore 根据 注释一 ,callback 存在，则 callbackName 必定不为 undefined\r\n      delete callbacks[callbackName];\r\n      return;\r\n    }\r\n\r\n    if (__DEV__) {\r\n      warning(\r\n        handlers[command] != null && handlers[command]!.length !== 0,\r\n        `对于指令 ${Command[command]} ,未添加任何处理函数`\r\n      );\r\n    }\r\n\r\n    if (handlers[command] != null) {\r\n      handlers[command]!.forEach((fn) => {\r\n        fn(data, (data: any) => {\r\n          //传递给用户的回调函数，下面是内部发送逻辑\r\n          if (callbackName != null) {\r\n            //只有设置了回调函数的指令调用该方法时才有效。\r\n            //@ts-ignore CALLBACK 为内部使用的，用于触发回调\r\n            this.postMessage(CALLBACK, data, callbackName);\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  //translation-page listen agent\r\n  onMessage(command: Command.BackHistory, listener: () => void): () => void;\r\n  onMessage(command: Command.ForwardHistory, listener: () => void): () => void;\r\n  onMessage(command: Command.PauseAudio, listener: () => void): () => void;\r\n  onMessage(\r\n    command: Command.OpenSelection,\r\n    listener: (data: boolean) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.HiddenChinese,\r\n    listener: (data: boolean) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.ShowTranslation,\r\n    listener: (data: TranslationResult, callback: () => void) => void\r\n  ): () => void;\r\n\r\n  //agent listen translation-page\r\n  onMessage(\r\n    command: Command.TranslateText,\r\n    listener: (data: string) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.HistoryIndex,\r\n    listener: (data: { index: number; head: number; tail: number }) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.RelearnNote,\r\n    listener: (\r\n      data: number[],\r\n      callback: (data: RelearnCardsReturnType) => void\r\n    ) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.AddNote,\r\n    listener: (\r\n      data: NoteData,\r\n      callback: (data: AddNoteReturnType) => void\r\n    ) => void\r\n  ): () => void;\r\n  onMessage(command: Command, listener: FunctionAny): () => void {\r\n    const handlers = this.handlers;\r\n\r\n    if (handlers[command] == null) {\r\n      handlers[command] = [listener];\r\n    } else {\r\n      handlers[command]!.push(listener);\r\n    }\r\n    //单例\r\n    let called = false;\r\n    return function () {\r\n      if (called) return;\r\n      called = true;\r\n      handlers[command] = handlers[command]!.filter((fn) => {\r\n        return fn !== listener;\r\n      });\r\n    };\r\n  }\r\n  //agent to translation-page\r\n  postMessage(command: Command.PauseAudio): void;\r\n  postMessage(command: Command.BackHistory): void;\r\n  postMessage(command: Command.ForwardHistory): void;\r\n  postMessage(command: Command.OpenSelection, data: boolean): void;\r\n  postMessage(command: Command.HiddenChinese, data: boolean): void;\r\n  postMessage(\r\n    command: Command.ShowTranslation,\r\n    data: TranslationResult,\r\n    callback: () => void\r\n  ): void;\r\n  // translation-page to agent\r\n  postMessage(command: Command.TranslateText, data: string): void;\r\n  postMessage(\r\n    command: Command.HistoryIndex,\r\n    data: { index: number; head: number; tail: number }\r\n  ): void;\r\n  postMessage(\r\n    command: Command.RelearnNote,\r\n    data: number[],\r\n    callback: (data: RelearnCardsReturnType) => void\r\n  ): void;\r\n  postMessage(\r\n    command: Command.AddNote,\r\n    data: NoteData,\r\n    callback: (data: AddNoteReturnType) => void\r\n  ): void;\r\n  postMessage(command: Command, data?: any, callback?: FunctionAny): void {\r\n    const target = this.target;\r\n    //此处应该使用报错的 invariant 而非 warning，因为其执行会添加回调函数，如果不报错属于内存泄漏\r\n    if (!target) {\r\n      invariant(false, \"target 不存在，其在通信中是必须的\");\r\n    }\r\n    /* 因为浏览器的postMessage不提供原生的响应回调功能，因此需要自定义实现\r\n     * 设置回调时:(postMessage)\r\n     *   如果存在回调函数，则创建一个唯一的ID保存该回调函数\r\n     *   该唯一ID保存在 data.callbackName 中，随请求携带\r\n     * 执行回调时:(onMessage)\r\n     *   定义收到command为\"callback\"的指令时，调用缓存的回调函数\r\n     *   该指令的data[callbackName]应该有值，通过该值进行正确的回调匹配\r\n     */\r\n    //确保data是引用数据类型\r\n    const message: MessageData = Object.create(null);\r\n    message.data = data;\r\n    message.command = command;\r\n    //如果传递的是number，则说明该次调用是为了触发回调，因为标识是number，所以此处判断number\r\n    //与用户无关，是触发回调的内部逻辑\r\n    if (typeof callback === \"number\") {\r\n      message.callbackName = callback;\r\n    }\r\n\r\n    if (typeof callback === \"function\") {\r\n      const callbackName = uniqueId;\r\n      this.callbacks[callbackName] = callback;\r\n      message.callbackName = callbackName;\r\n      uniqueId++; //保证唯一性\r\n    }\r\n\r\n    target.postMessage(message, \"*\");\r\n  }\r\n}\r\n","/**\r\n * invariant 与 warning 的名称不应该改变，其会被 babel的 \"babel-plugin-dev-expression\" 插件替换，\r\n *  具体可看：\"https://www.npmjs.com/package/babel-plugin-dev-expression\"\r\n */\r\n\r\nexport function invariant(cond: boolean, message: string): asserts cond {\r\n  if (!cond) throw new Error(message);\r\n}\r\n\r\nexport function warning(cond: boolean, message: string) {\r\n  if (!cond) {\r\n    if (typeof console !== \"undefined\") console.warn(message);\r\n\r\n    try {\r\n      //这样的写法是为了便于调试，能够使其支持 “在遇到异常时暂停”（如果选中该调试功能的话）\r\n      throw new Error(message);\r\n      // eslint-disable-next-line no-empty\r\n    } catch (e) {}\r\n  }\r\n}\r\n","export { invariant, warning } from \"./alert\";\r\nexport { validateText } from \"./validateText\";\r\nexport { Messenger } from \"./Messenger\";\r\nexport type { PostMessage, OnMessage } from \"./Messenger\";\r\n\r\n/**\r\n * 纯函数，Object.entries()的单一版本，只提取单个键的[key,value]\r\n */\r\nexport function extractEntry<T extends object, K extends keyof T>(\r\n  target: T,\r\n  key: K\r\n): [K, T[K]] {\r\n  return [key, target[key]];\r\n}\r\n","/**\r\n * 纯函数，过滤掉无效查询\r\n *  - 字符串为空的情况\r\n *  - 查询主体并非英文\r\n * @param text\r\n * @return 返回过滤后的字符，该字符应当是符合查询要求的\r\n */\r\n export function validateText(text: string) {\r\n  text = text.trim();\r\n\r\n  //过滤为空的字符串\r\n  if (!text) return false;\r\n\r\n  //如果英文字母数量不足百分之五十，则认为其并非需要查询的内容\r\n  const amount = text.match(/\\b[a-z]+\\b/gi)?.reduce((amount, item) => {\r\n    return amount + item.length;\r\n  }, 0);\r\n  if (!amount || amount / text.length < 0.5) return false;\r\n\r\n  //过滤用户对URL的复制的查询\r\n  if (text.search(/http:|https:/gi) === 0) return false;\r\n\r\n  return true;\r\n}\r\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0,\n    MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    symbolTag = '[object Symbol]';\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\n/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * The base implementation of `_.flatten` with support for restricting flattening.\n *\n * @private\n * @param {Array} array The array to flatten.\n * @param {number} depth The maximum recursion depth.\n * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n * @param {Array} [result=[]] The initial result value.\n * @returns {Array} Returns the new flattened array.\n */\nfunction baseFlatten(array, depth, predicate, isStrict, result) {\n  var index = -1,\n      length = array.length;\n\n  predicate || (predicate = isFlattenable);\n  result || (result = []);\n\n  while (++index < length) {\n    var value = array[index];\n    if (depth > 0 && predicate(value)) {\n      if (depth > 1) {\n        // Recursively flatten arrays (susceptible to call stack limits).\n        baseFlatten(value, depth - 1, predicate, isStrict, result);\n      } else {\n        arrayPush(result, value);\n      }\n    } else if (!isStrict) {\n      result[result.length] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.pick` without support for individual\n * property identifiers.\n *\n * @private\n * @param {Object} object The source object.\n * @param {string[]} props The property identifiers to pick.\n * @returns {Object} Returns the new object.\n */\nfunction basePick(object, props) {\n  object = Object(object);\n  return basePickBy(object, props, function(value, key) {\n    return key in object;\n  });\n}\n\n/**\n * The base implementation of  `_.pickBy` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The source object.\n * @param {string[]} props The property identifiers to pick from.\n * @param {Function} predicate The function invoked per property.\n * @returns {Object} Returns the new object.\n */\nfunction basePickBy(object, props, predicate) {\n  var index = -1,\n      length = props.length,\n      result = {};\n\n  while (++index < length) {\n    var key = props[index],\n        value = object[key];\n\n    if (predicate(value, key)) {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = array;\n    return apply(func, this, otherArgs);\n  };\n}\n\n/**\n * Checks if `value` is a flattenable `arguments` object or array.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n */\nfunction isFlattenable(value) {\n  return isArray(value) || isArguments(value) ||\n    !!(spreadableSymbol && value && value[spreadableSymbol]);\n}\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Creates an object composed of the picked `object` properties.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The source object.\n * @param {...(string|string[])} [props] The property identifiers to pick.\n * @returns {Object} Returns the new object.\n * @example\n *\n * var object = { 'a': 1, 'b': '2', 'c': 3 };\n *\n * _.pick(object, ['a', 'c']);\n * // => { 'a': 1, 'c': 3 }\n */\nvar pick = baseRest(function(object, props) {\n  return object == null ? {} : basePick(object, arrayMap(baseFlatten(props, 1), toKey));\n});\n\nmodule.exports = pick;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * 用于右键菜单注入的代码\r\n */\r\nimport {\r\n  CursorListener,\r\n  SelectionListener,\r\n  HotKeyListener,\r\n} from \"@/user-operation\";\r\n\r\nimport {\r\n  postBackend,\r\n  getStorageByObject,\r\n  onStorageChange,\r\n} from \"@/extensions-api\";\r\n\r\nimport { validateText } from \"@/utils\";\r\nimport { Command } from \"@/configuration\";\r\n\r\n//添加获取鼠标位置的监听\r\nconst cursorListener = new CursorListener();\r\nconst { getClientPoint, getScreenPoint } = cursorListener;\r\nconst selectionListener = new SelectionListener(translateText);\r\n\r\nconst hotKeyListener = new HotKeyListener(translateText, getClientPoint);\r\ncursorListener.install();\r\n\r\nasync function translateText(text: string) {\r\n  //过滤掉非英文\r\n  const result = validateText(text);\r\n  if (!result) return;\r\n\r\n  const point = getScreenPoint();\r\n  postBackend(Command.TranslateInjectText, { text, point });\r\n}\r\n\r\nfunction openSelectionAndHotKeyListener() {\r\n  hotKeyListener.install();\r\n  selectionListener.install();\r\n}\r\n\r\nfunction closeSelectionAndHotKeyListener() {\r\n  hotKeyListener.uninstall();\r\n  selectionListener.uninstall();\r\n}\r\n\r\ngetStorageByObject({\r\n  switchHotkeyAndSelectionListener(value) {\r\n    return value\r\n      ? openSelectionAndHotKeyListener()\r\n      : closeSelectionAndHotKeyListener();\r\n  },\r\n  hotKey(value) {\r\n    return hotKeyListener.updateHotKey(value);\r\n  },\r\n  switchStrengthenSelectionByPressedCtrl(value) {\r\n    return selectionListener.switchStrengthenSelectionByPressedCtrl(value);\r\n  },\r\n});\r\n\r\nonStorageChange({\r\n  switchHotkeyAndSelectionListener(_, value) {\r\n    return value\r\n      ? openSelectionAndHotKeyListener()\r\n      : closeSelectionAndHotKeyListener();\r\n  },\r\n  hotKey(_, value) {\r\n    return hotKeyListener.updateHotKey(value);\r\n  },\r\n  switchStrengthenSelectionByPressedCtrl(_, value) {\r\n    return selectionListener.switchStrengthenSelectionByPressedCtrl(value);\r\n  },\r\n});\r\n"],"names":["Command","WORD_FIELDS_MAP","PHRASE_FIELDS_MAP","COMMON_CONFIG_MAP","SENTENCE_FIELDS_MAP","ANKI_CONNECTION_MAP","DEFAULT_ANKI_CONNECTION_URL","definition","word","translation","part_of_speech","definition_audio","am","en","am_audio","en_audio","star_amount","example_audio","example_sentence","example_sentence_translation","phrase","phrase_audio","translations","example_audio_1","example_audio_2","example_audio_3","example_sentence_1","example_sentence_2","example_sentence_3","example_sentence_translation_1","example_sentence_translation_2","example_sentence_translation_3","sentence","sentence_audio","sentence_translation","deckName","modelName","tags","ankiConnectionMethod","ankiConnectionURL","Object","freeze","setBadgeText","details","callback","chrome","browserAction","onCommand","handlerObject","commands","addListener","command","handler","StrictOnCommand","runtime","getManifest","Error","commandNames","keys","forEach","addContextMenuItem","createProperties","contextMenus","create","onContextMenuClick","onClicked","getStorageByArray","getStorageByObject","setStorage","onStorageChange","executeScript","postFrontend","postBackend","onMessage","getURL","openOptionsPage","TabPanelName","name","data","Promise","resolve","sendMessage","response","message","sender","_sendResponse","called","sendResponse","then","pick","defaultStorage","switchHotkeyAndSelectionListener","hotKey","openSelection","hiddenChinese","checkedTabPanel","Home","switchStrengthenSelectionByPressedCtrl","wordConfig","phraseConfig","sentenceConfig","checkWordDuplicate","checkPhraseDuplicate","checkSentenceDuplicate","handlersIsArray","handlers","Array","isArray","getStorage","storageKeys","storage","local","get","key","cacheValue","names","listener","changes","oldValue","newValue","onChanged","removeListener","partialStorage","set","tabs","query","active","tab","id","CursorListener","x","y","clientPoint","screenPoint","document","addEventListener","onMouseMove","removeEventListener","event","clientX","clientY","screenY","screenX","getSelectionText","getRangeFromPoint","isContentEditable","isSearchContainer","UserSelectHandler","HotKeyListener","translateAndDisplayText","getPoint","onKeyDown","restore","focusNode","activeElement","autoSelectText","selectedText","letter","checkout","test","range","extendRange","selection","getSelection","target","commonAncestorContainer","parentElement","modify","removeAllRanges","addRange","textNode","startContainer","isText","limit_left","limit_right","length","text","startOffset","endOffset","validate","Math","min","newRange","Range","setStart","setEnd","node","nodeType","attachSymbolToSearchContainer","SearchBox","body","append","container","closeSearchBox","remove","createSearchBar","openSearchBox","FORM_ID","INPUT_ID","BUTTON_ID","createElement","style","setProperty","shadow","attachShadow","mode","innerHTML","form","getElementById","input","button","preventDefault","value","trim","display","focus","select","SelectionListener","onMouseDown","onMouseUp","enableCtrl","onSelectionChange","once","selectionChanged","ctrlKey","USER_SELECT","Map","element","modifiedHTMLElements","has","userSelectValue","getPropertyValue","userSelectPriority","getPropertyPriority","priority","clear","caretRangeFromPoint","caretPosition","caretPositionFromPoint","offsetNode","offset","createRange","toString","includes","tagName","HTMLElement","SEARCH_CONTAINER_ID","ATTRIBUTE_NAME","getAttribute","setAttribute","warning","invariant","uniqueId","CALLBACK","Messenger","options","self","handleMessage","callbacks","source","callbackName","fn","postMessage","bind","push","filter","cond","console","warn","e","validateText","extractEntry","amount","match","reduce","item","search","cursorListener","getClientPoint","getScreenPoint","selectionListener","translateText","hotKeyListener","install","result","point","TranslateInjectText","openSelectionAndHotKeyListener","closeSelectionAndHotKeyListener","uninstall","updateHotKey","_"],"sourceRoot":""}