{"version":3,"file":"contentScript.js","mappings":"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CA,IAAIC,IAAI,CAACkF,MAAL,CAAY,gBAAZ,MAAkC,CAAtC,EAAyC,OAAO,KAAP;EAEzC,OAAO,IAAP;AACD;;;;;;;;;;ACvBD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,wBAAwB,qBAAM,gBAAgB,qBAAM,IAAI,qBAAM,sBAAsB,qBAAM;;AAE1F;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,GAAG;AACd,WAAW,OAAO;AAClB,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,WAAW,UAAU;AACrB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB,WAAW,QAAQ;AACnB,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,eAAe;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA,8BAA8B,mBAAmB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,sBAAsB;AACjC,aAAa,QAAQ;AACrB;AACA;AACA,kBAAkB;AAClB;AACA;AACA,WAAW;AACX;AACA;AACA,6BAA6B;AAC7B,CAAC;;AAED;;;;;;;UCtfA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;;;;;;ACNA;AAMA;AAEA;AACA;CAQA;;AACA,IAAMC,cAAc,GAAG,IAAIzH,2DAAJ,EAAvB;AACA,IAAQ0H,cAAR,GAA2BD,cAA3B,CAAQC,cAAR;AACA,IAAMC,SAAS,GAAG,IAAI1E,sDAAJ,CAAc2E,0BAAd,CAAlB;AACA,IAAMC,iBAAiB,GAAG,IAAI3D,8DAAJ,CAAsB4D,oBAAtB,CAA1B;AACA,IAAMC,cAAc,GAAG,IAAIpH,2DAAJ,CAAmBmH,oBAAnB,EAAyCJ,cAAzC,CAAvB;AACAD,cAAc,CAACrS,OAAf;AACAuS,SAAS,CAACvS,OAAV,IAEA;;AACA,IAAM4S,KAAK,GAAG,IAAI9S,yCAAJ,EAAd;AACA8S,KAAK,CAACnQ,SAAN,CAAgB3F,2DAAhB;EAAA,6BAAiC,WAAOqE,IAAP,EAAaiH,YAAb,EAA8B;IAC7D,IAAML,QAAQ,SAASN,4DAAW,CAAC3K,2DAAD,EAAkBqE,IAAlB,CAAlC;IACAiH,YAAY,CAACL,QAAD,CAAZ;EACD,CAHD;;EAAA;IAAA;EAAA;AAAA;AAIA6K,KAAK,CAACnQ,SAAN,CAAgB3F,+DAAhB;EAAA,8BAAqC,WAAOqE,IAAP,EAAaiH,YAAb,EAA8B;IACjE,IAAML,QAAQ,SAASN,4DAAW,CAAC3K,+DAAD,EAAsBqE,IAAtB,CAAlC;IACAiH,YAAY,CAACL,QAAD,CAAZ;EACD,CAHD;;EAAA;IAAA;EAAA;AAAA;AAIA6K,KAAK,CAACnQ,SAAN,CAAgB3F,iEAAhB,EAAuC,UAAUqE,IAAV,EAAgB;EACrD6R,0BAA0B,CAAC7R,IAAD,CAA1B;AACD,CAFD;AAGAyR,KAAK,CAAC5S,OAAN;AAEA;AACA;AACA;;AACA,SAASiT,+BAAT,CAAyC9R,IAAzC,EAAmE;EACjE,kBAAeA,IAAI,CAACE,KAApB;EAAA,IAAMQ,CAAN,eAAMA,CAAN;EAAA,IAASE,CAAT,eAASA,CAAT,CADiE,CAEjE;;EACAF,CAAC,IAAIW,MAAM,CAACyI,OAAZ;EACAlJ,CAAC,IAAIS,MAAM,CAACwI,OAAZ;EACA,IAAM3J,KAAK,GAAG;IAAEQ,CAAC,EAADA,CAAF;IAAKE,CAAC,EAADA;EAAL,CAAd,CALiE,CAMjE;;EACAV,KAAK,CAACQ,CAAN,IAAWW,MAAM,CAAC0Q,UAAP,GAAoB1Q,MAAM,CAAC2Q,UAAtC;EACA,IAAI9R,KAAK,CAACQ,CAAN,GAAU,CAAd,EAAiBR,KAAK,CAACQ,CAAN,GAAUA,CAAV;EACjBR,KAAK,CAACU,CAAN,IAAWS,MAAM,CAAC4Q,WAAP,GAAqB5Q,MAAM,CAAC6Q,WAAvC;EACA,IAAIhS,KAAK,CAACU,CAAN,GAAU,CAAd,EAAiBV,KAAK,CAACU,CAAN,GAAUA,CAAV;EACjB6Q,KAAK,CAACU,eAAN,CAAsB;IACpBlS,cAAc,EAAED,IAAI,CAACC,cADD;IAEpBC,KAAK,EAALA;EAFoB,CAAtB;AAID;AACD;AACA;AACA;AACA;AACA;;;SACeqR;;;AAaf;AACA;AACA;AACA;;;;4CAhBA,WAAoCxF,IAApC,EAAkD;IAChD;IACA;IACA,IAAI0F,KAAK,CAACW,SAAN,EAAJ,EAAuB,OAHyB,CAKhD;;IACA,IAAMC,MAAM,GAAGzB,oDAAY,CAAC7E,IAAD,CAA3B;IACA,IAAI,CAACsG,MAAL,EAAa;IAEb,IAAMpS,cAAc,SAASqG,4DAAW,CAAC3K,iEAAD,EAAwBoQ,IAAxB,CAAxC;IACA,IAAM7L,KAAK,GAAGiR,cAAc,EAA5B;IACAM,KAAK,CAACU,eAAN,CAAsB;MAAElS,cAAc,EAAdA,cAAF;MAAkBC,KAAK,EAALA;IAAlB,CAAtB;EACD;;;;SAKcmR;;;AAKf;AACA;AACA;AACA;;;;kDARA,WAA0CtF,IAA1C,EAAwD;IACtD,IAAM9L,cAAc,SAASqG,4DAAW,CAAC3K,iEAAD,EAAwBoQ,IAAxB,CAAxC;IACA,IAAM7L,KAAK,GAAGiR,cAAc,EAA5B;IACAM,KAAK,CAACU,eAAN,CAAsB;MAAElS,cAAc,EAAdA,cAAF;MAAkBC,KAAK,EAALA;IAAlB,CAAtB;EACD;;;;SAKc2R;;;;;kDAAf,WAA0C9F,IAA1C,EAAwD;IACtD;IACA,IAAMsG,MAAM,GAAGzB,oDAAY,CAAC7E,IAAD,CAA3B;IACA,IAAI,CAACsG,MAAL,EAAa;IACb,IAAMpS,cAAc,SAASqG,4DAAW,CAAC3K,iEAAD,EAAwBoQ,IAAxB,CAAxC;IACA0F,KAAK,CAACU,eAAN,CAAsB;MAAElS,cAAc,EAAdA;IAAF,CAAtB;EACD;;;;AAED,SAASqS,8BAAT,GAA0C;EACxCd,cAAc,CAAC3S,OAAf;EACAyS,iBAAiB,CAACzS,OAAlB;AACD;;AAED,SAAS0T,+BAAT,GAA2C;EACzCf,cAAc,CAACrS,SAAf;EACAmS,iBAAiB,CAACnS,SAAlB;AACD;;AAED+G,mEAAkB,CAAC;EACjBmB,gCADiB,4CACgBiG,KADhB,EACuB;IACtC,OAAOA,KAAK,GACRgF,8BAA8B,EADtB,GAERC,+BAA+B,EAFnC;EAGD,CALgB;EAMjBjL,MANiB,kBAMVgG,KANU,EAMH;IACZ,OAAOkE,cAAc,CAACgB,YAAf,CAA4BlF,KAA5B,CAAP;EACD,CARgB;EASjB7F,sCATiB,kDASsB6F,KATtB,EAS6B;IAC5C,OAAOgE,iBAAiB,CAAC7J,sCAAlB,CAAyD6F,KAAzD,CAAP;EACD;AAXgB,CAAD,CAAlB;AAcAnH,gEAAe,CAAC;EACdkB,gCADc,4CACmBoL,CADnB,EACsBnF,KADtB,EAC6B;IACzC,OAAOA,KAAK,GACRgF,8BAA8B,EADtB,GAERC,+BAA+B,EAFnC;EAGD,CALa;EAMdjL,MANc,kBAMPmL,CANO,EAMJnF,KANI,EAMG;IACf,OAAOkE,cAAc,CAACgB,YAAf,CAA4BlF,KAA5B,CAAP;EACD,CARa;EASd7F,sCATc,kDASyBgL,CATzB,EAS4BnF,KAT5B,EASmC;IAC/C,OAAOgE,iBAAiB,CAAC7J,sCAAlB,CAAyD6F,KAAzD,CAAP;EACD;AAXa,CAAD,CAAf,EAcA;;AACAhM,0DAAS;EAAA,8BAAC,kBAA6B;IAAA,IAApB6D,OAAoB,SAApBA,OAAoB;IAAA,IAAXnF,IAAW,SAAXA,IAAW;IACrC,IAAImF,OAAO,KAAKxJ,8DAAhB,EAAoC8V,KAAK,CAACrR,MAAN,CAAa+Q,cAAc,EAA3B;IACpC,IAAIhM,OAAO,KAAKxJ,iEAAhB,EAAuCyV,SAAS,CAACvE,aAAV;IACvC,IAAI1H,OAAO,KAAKxJ,yEAAhB,EACEmW,+BAA+B,CAAC9R,IAAD,CAA/B;EACH,CALQ;;EAAA;IAAA;EAAA;AAAA,IAAT,C","sources":["webpack://translator-extensions/./src/configuration/command.ts","webpack://translator-extensions/./src/configuration/index.ts","webpack://translator-extensions/./src/configuration/modelFieldNameMap.ts","webpack://translator-extensions/./src/content-script/Agent.ts","webpack://translator-extensions/./src/extensions-api/browserAction.ts","webpack://translator-extensions/./src/extensions-api/commands.ts","webpack://translator-extensions/./src/extensions-api/contextMenus.ts","webpack://translator-extensions/./src/extensions-api/index.ts","webpack://translator-extensions/./src/extensions-api/runtime.ts","webpack://translator-extensions/./src/extensions-api/storage.ts","webpack://translator-extensions/./src/extensions-api/tabs.ts","webpack://translator-extensions/./src/extensions-api/types/index.ts","webpack://translator-extensions/./src/user-operation/CursorListener.ts","webpack://translator-extensions/./src/user-operation/HotKeyListener.ts","webpack://translator-extensions/./src/user-operation/SearchBox.ts","webpack://translator-extensions/./src/user-operation/SelectionListener.ts","webpack://translator-extensions/./src/user-operation/index.ts","webpack://translator-extensions/./src/user-operation/utils/UserSelectHandler.ts","webpack://translator-extensions/./src/user-operation/utils/getRangeFromPoint.ts","webpack://translator-extensions/./src/user-operation/utils/getSelectionText.ts","webpack://translator-extensions/./src/user-operation/utils/index.ts","webpack://translator-extensions/./src/user-operation/utils/isContentEditable.ts","webpack://translator-extensions/./src/user-operation/utils/verifySearchContainer.ts","webpack://translator-extensions/./src/utils/Messenger.ts","webpack://translator-extensions/./src/utils/alert.ts","webpack://translator-extensions/./src/utils/index.ts","webpack://translator-extensions/./src/utils/validateText.ts","webpack://translator-extensions/./node_modules/.pnpm/registry.npmmirror.com+lodash.pick@4.4.0/node_modules/lodash.pick/index.js","webpack://translator-extensions/webpack/bootstrap","webpack://translator-extensions/webpack/runtime/compat get default export","webpack://translator-extensions/webpack/runtime/define property getters","webpack://translator-extensions/webpack/runtime/global","webpack://translator-extensions/webpack/runtime/hasOwnProperty shorthand","webpack://translator-extensions/webpack/runtime/make namespace object","webpack://translator-extensions/./src/content-script/index.ts"],"sourcesContent":["export enum Command {\r\n  AddNote,\r\n  UpdateNote,\r\n  RelearnNote,\r\n  HistoryIndex,\r\n  TranslateText,\r\n\r\n  PauseAudio,\r\n  ShowTranslation,\r\n  OpenSelection,\r\n  HiddenChinese,\r\n  BackHistory,\r\n  ForwardHistory,\r\n  Callback,\r\n  OpenSearchBox,\r\n  ShowInjectTranslation,\r\n  ShowIframe,\r\n\r\n  GetVersion,\r\n  GetDeckNames,\r\n  GetModelNames,\r\n  GetModelFieldNames,\r\n\r\n  TranslateInjectText,\r\n}\r\n","export {\r\n  WORD_FIELDS_MAP,\r\n  PHRASE_FIELDS_MAP,\r\n  COMMON_CONFIG_MAP,\r\n  SENTENCE_FIELDS_MAP,\r\n  ANKI_CONNECTION_MAP,\r\n} from \"./modelFieldNameMap\";\r\n\r\nexport { Command } from \"./command\";\r\n\r\nexport const DEFAULT_ANKI_CONNECTION_URL = \"http://127.0.0.1:8765\";\r\n","import {\r\n  WordFields,\r\n  PhraseFields,\r\n  CommonConfig,\r\n  SentenceFields,\r\n} from \"@/extensions-api\";\r\n\r\nconst WORD_FIELDS_MAP: WordFields = {\r\n  definition: \"定义\",\r\n  word: \"单词\",\r\n  translation: \"翻译\",\r\n  part_of_speech: \"词性\",\r\n  definition_audio: \"定义音频\",\r\n  am: \"美国音标\",\r\n  en: \"英国音标\",\r\n  am_audio: \"美国音频\",\r\n  en_audio: \"英国音频\",\r\n  star_amount: \"出现频率\",\r\n  example_audio: \"例句音频\",\r\n  example_sentence: \"例句原文\",\r\n  example_sentence_translation: \"例句翻译\",\r\n};\r\n\r\nconst PHRASE_FIELDS_MAP: PhraseFields = {\r\n  phrase: \"短语词组\",\r\n  phrase_audio: \"短语音频\",\r\n  translations: \"短语翻译\",\r\n  example_audio_1: \"例句1音频\",\r\n  example_audio_2: \"例句2音频\",\r\n  example_audio_3: \"例句3音频\",\r\n  example_sentence_1: \"例句1原文\",\r\n  example_sentence_2: \"例句2原文\",\r\n  example_sentence_3: \"例句3原文\",\r\n  example_sentence_translation_1: \"例句1翻译\",\r\n  example_sentence_translation_2: \"例句2翻译\",\r\n  example_sentence_translation_3: \"例句3翻译\",\r\n};\r\n\r\nconst SENTENCE_FIELDS_MAP: SentenceFields = {\r\n  sentence: \"句子原文\",\r\n  sentence_audio: \"句子音频\",\r\n  sentence_translation: \"句子翻译\",\r\n};\r\n\r\nconst COMMON_CONFIG_MAP: CommonConfig = {\r\n  deckName: \"牌组名称\",\r\n  modelName: \"模型名称\",\r\n  tags: \"卡片标签\",\r\n};\r\n\r\nconst ANKI_CONNECTION_MAP = {\r\n  ankiConnectionMethod: \"连接方法\",\r\n  ankiConnectionURL: \"连接URL\",\r\n};\r\n\r\nif (__DEV__) {\r\n  Object.freeze(WORD_FIELDS_MAP);\r\n  Object.freeze(PHRASE_FIELDS_MAP);\r\n  Object.freeze(SENTENCE_FIELDS_MAP);\r\n  Object.freeze(COMMON_CONFIG_MAP);\r\n  Object.freeze(ANKI_CONNECTION_MAP);\r\n}\r\n\r\nexport {\r\n  WORD_FIELDS_MAP,\r\n  COMMON_CONFIG_MAP,\r\n  PHRASE_FIELDS_MAP,\r\n  SENTENCE_FIELDS_MAP,\r\n  ANKI_CONNECTION_MAP,\r\n};\r\n","import { Point, ShowData } from \"@/types\";\r\nimport { Command } from \"@/configuration\";\r\nimport { Messenger, PostMessage, OnMessage } from \"@/utils\";\r\nimport { getURL, getStorageByArray, setStorage } from \"@/extensions-api\";\r\n//魔法字符串\r\nconst openSelection = \"OPEN_SELECTION\";\r\nconst hiddenChinese = \"HIDDEN_CHINESE\";\r\n\r\nexport class Agent {\r\n  mask?: HTMLDivElement;\r\n  configMask?: HTMLDivElement;\r\n  configContainer;\r\n  translationWrapper;\r\n  translationContainer;\r\n  messenger: Messenger;\r\n  onMessage: OnMessage;\r\n  postMessage: PostMessage;\r\n\r\n  constructor() {\r\n    //建立通信\r\n    this.messenger = new Messenger({\r\n      self: window,\r\n    });\r\n    this.onMessage = this.messenger.onMessage;\r\n    this.postMessage = this.messenger.postMessage;\r\n    //创建iframe\r\n    const {\r\n      iframe,\r\n      wrapper,\r\n      container,\r\n      backButton,\r\n      configButton,\r\n      forwardButton,\r\n      configContainer,\r\n    } = createTranslationView();\r\n    this.translationWrapper = wrapper;\r\n    this.translationContainer = container;\r\n    this.configContainer = configContainer;\r\n\r\n    //保证获取contentWindow\r\n    iframe.addEventListener(\"load\", () => {\r\n      const contentWindow = iframe.contentWindow;\r\n      this.messenger.addTarget(contentWindow!);\r\n      this.messenger.install();\r\n\r\n      //实现历史按钮的明暗功能 明（存在历史记录） ,暗（不存在历史记录）\r\n      this.onMessage(Command.HistoryIndex, ({ index, head, tail }) => {\r\n        if (index <= head) {\r\n          backButton.classList.add(\"invalid\");\r\n        } else {\r\n          backButton.classList.remove(\"invalid\");\r\n        }\r\n\r\n        if (index >= tail) {\r\n          forwardButton.classList.add(\"invalid\");\r\n        } else {\r\n          forwardButton.classList.remove(\"invalid\");\r\n        }\r\n      });\r\n\r\n      /**\r\n       * 实现对 translation-page 是否支持 selection 翻译 以及 是否隐藏 中文翻译 的控制\r\n       */\r\n      configContainer.addEventListener(\"input\", (event) => {\r\n        const input = event.target;\r\n        if (!isInputElement(input)) return;\r\n\r\n        if (input.name === openSelection) {\r\n          const isOpen = input.checked;\r\n          this.postMessage(Command.OpenSelection, isOpen);\r\n          setStorage({\r\n            openSelection: isOpen,\r\n          });\r\n        }\r\n\r\n        if (input.name === hiddenChinese) {\r\n          const hidden = input.checked;\r\n          this.postMessage(Command.HiddenChinese, hidden);\r\n          setStorage({\r\n            hiddenChinese: hidden,\r\n          });\r\n        }\r\n      });\r\n\r\n      const configMask = createMask(`\r\n        position:absolute;\r\n        margin:0;\r\n        left:0;\r\n        top:0;\r\n        right:0;\r\n        bottom:0;\r\n      `);\r\n      this.configMask = configMask;\r\n\r\n      configMask.addEventListener(\"click\", () => {\r\n        configContainer.classList.add(\"hidden\");\r\n        configMask.remove();\r\n      });\r\n      container.addEventListener(\"click\", (event) => {\r\n        const target = event.target;\r\n        if (target === configButton) {\r\n          configContainer.classList.remove(\"hidden\");\r\n          //需要用到层叠规则的‘后来居上’，所以使用prepend插入configMask\r\n          container.prepend(configMask);\r\n        }\r\n        if (target === backButton) {\r\n          this.messenger.postMessage(Command.BackHistory);\r\n        }\r\n        if (target === forwardButton) {\r\n          this.messenger.postMessage(Command.ForwardHistory);\r\n        }\r\n      });\r\n\r\n      //拖拽\r\n      //因为拖拽是通过监听document上的鼠标移动实现的，而内部存在iframe会导致对document的监听失效\r\n      //因此在拖拽行为发生的时候，生成一个层次更高的蒙版，以能够正确的监听document上的鼠标移动\r\n      const moveMask = createMask(`\r\n        position:fixed;\r\n        margin:0;\r\n        left:0;\r\n        top:0;\r\n        bottom:0;\r\n        right:0;\r\n      `);\r\n      let count = 0; //用于降低拖拽判断的灵敏度，避免用户单击出现问题\r\n\r\n      container.addEventListener(\"mousedown\", (event) => {\r\n        const { left, top } = container.getBoundingClientRect();\r\n        const clientX = event.clientX;\r\n        const clientY = event.clientY;\r\n        const relativeX = clientX - left;\r\n        const relativeY = clientY - top;\r\n\r\n        const mouseMoveHandle = function mouseMoveHandle(event: MouseEvent) {\r\n          count++;\r\n          if (count <= 3) return; //要先触发三次该事件才认为用户执行拖拽\r\n\r\n          container.append(moveMask);\r\n          container.style.left = event.clientX - relativeX + \"px\";\r\n          container.style.top = event.clientY - relativeY + \"px\";\r\n        };\r\n\r\n        const mouseUpHandle = function mouseUpHandle() {\r\n          moveMask.remove();\r\n          count = 0; //重置数值\r\n\r\n          document.removeEventListener(\"mousemove\", mouseMoveHandle);\r\n          document.removeEventListener(\"mouseup\", mouseUpHandle);\r\n        };\r\n\r\n        document.addEventListener(\"mousemove\", mouseMoveHandle);\r\n        document.addEventListener(\"mouseup\", mouseUpHandle);\r\n      });\r\n\r\n      getStorageByArray([\"openSelection\", \"hiddenChinese\"], (item) => {\r\n        this.postMessage(Command.OpenSelection, !!item.openSelection);\r\n        this.postMessage(Command.HiddenChinese, !!item.hiddenChinese);\r\n      });\r\n    });\r\n    //此处的translationPage.html需要参考所生成文件的具体名称\r\n    iframe.src = getURL(\"translationPage.html\");\r\n\r\n    /**\r\n     * 之所以不使用 inset: 0px; 的写法，是因为那样写会占用更多的内存\r\n     *  该 mask 已经提升到合成层，而合成层会占用更大的内存，而占用的内存与元素大小正相关\r\n     *  通过下面的写法，元素的大小为 1*1,占用内存小，而用scale放大后又可以保证原有效果（本质是时间换空间？）\r\n     */\r\n    const mask = createMask(`\r\n      position:fixed;\r\n      z-index:99999;\r\n      top:50%;\r\n      left:50%;\r\n      width:1px;\r\n      height:1px;\r\n      transform:scale(5000);\r\n      background:rgba(0,0,0,.3);\r\n    `);\r\n    this.mask = mask;\r\n    this.mask.addEventListener(\"click\", this.onClickToggle);\r\n  }\r\n  install = () => {\r\n    this.messenger?.install();\r\n    document.body.append(this.translationWrapper);\r\n  };\r\n  uninstall = () => {\r\n    this.hiddenTranslationView();\r\n    this.messenger?.uninstall();\r\n    this.translationWrapper.remove();\r\n  };\r\n  isVisible = () => {\r\n    return this.mask?.isConnected;\r\n  };\r\n  onClickToggle = () => {\r\n    this.hiddenTranslationView();\r\n    this.postMessage(Command.PauseAudio);\r\n  };\r\n  hiddenTranslationView = () => {\r\n    this.mask?.remove();\r\n    this.configMask?.remove();\r\n    //不能够使用 hidden=true 的形式，因为那样会导致 translationContainer 在渲染树中删除\r\n    //这样会导致 translationPage 更新时，不能够实时获取内部元素的高度\r\n    this.translationContainer.style.visibility = \"\";\r\n    this.configContainer.classList.add(\"hidden\");\r\n  };\r\n  showTranslation = (data: ShowData) => {\r\n    const translatedData = data.translatedData;\r\n    const point = data.point;\r\n    this.postMessage(Command.ShowTranslation, translatedData, () => {\r\n      //UI更新后再展示iframe,避免闪烁\r\n      this.showUI(point);\r\n    });\r\n  };\r\n  showUI = (point?: Point) => {\r\n    const rect = this.translationContainer.getBoundingClientRect();\r\n    const width = rect.width;\r\n    const height = rect.height;\r\n    let left = point?.x || rect.left;\r\n    let top = point?.y || rect.top; \r\n    //用于判断是否超出视口\r\n    const clientWidth = document.documentElement.clientWidth;\r\n    const clientHeight = document.documentElement.clientHeight; \r\n    //对越界位置进行修正\r\n    left = Math.min(Math.max(0, left), clientWidth - width);\r\n    top = Math.min(Math.max(0, top), clientHeight - height);\r\n\r\n    this.mask!.isConnected && document.body.append(this.mask!);\r\n    this.translationContainer.style.cssText = `\r\n      visibility:visible;\r\n      left:${left}px;\r\n      top:${top}px;\r\n    `;\r\n  };\r\n}\r\n\r\nfunction isInputElement(ele: any): ele is HTMLInputElement {\r\n  //先排除非对象类型\r\n  if (Object(ele) !== ele) return false;\r\n  if (!(ele instanceof Element)) return false;\r\n  return ele.tagName === \"INPUT\";\r\n}\r\n\r\nfunction createMask(cssText: string) {\r\n  //通过蒙版点击监听来隐藏 translationPage，如果绑定在document上，有可能因为处于其它iframe而无效\r\n  const wrapper = document.createElement(\"div\");\r\n  wrapper.style.setProperty(\"display\", \"contents\", \"important\");\r\n  const shadowRoot = wrapper.attachShadow({\r\n    mode: \"open\",\r\n  });\r\n  shadowRoot.innerHTML = `\r\n    <style>\r\n      .mask {\r\n        ${cssText}\r\n      }\r\n    </style>\r\n  `;\r\n  const mask = document.createElement(\"div\");\r\n  mask.classList.add(\"mask\");\r\n  shadowRoot.append(mask);\r\n  return wrapper;\r\n}\r\n\r\nfunction createTranslationView() {\r\n  const width = 400;\r\n  const height = 300;\r\n  const wrapper = document.createElement(\"div\"); \r\n  //创建幽灵节点\r\n  wrapper.style.setProperty(\"display\", \"contents\", \"important\");\r\n  const shadowRoot = wrapper.attachShadow({\r\n    mode: \"open\",\r\n  });\r\n\r\n  shadowRoot.innerHTML = `\r\n    <style>\r\n      .container {\r\n        position:fixed;\r\n        visibility:hidden;\r\n        z-index: 999999;\r\n        border-radius: 6px;\r\n        background: #fff;\r\n        user-select:none;\r\n      }\r\n      .header {\r\n        height:30px;\r\n      }\r\n      .iframe {\r\n        width:${width}px;\r\n        height:${height}px;\r\n        border: none;\r\n      }\r\n      .config {\r\n        float: right;\r\n        font-weight: 700;\r\n      }\r\n      .back,.forward {\r\n        float:left;\r\n        margin-left:5px;\r\n      }\r\n      .back,\r\n      .config,\r\n      .forward{\r\n        height: 30px;\r\n        width: 30px;\r\n        padding: 0;\r\n        color: inherit;\r\n        font-size: 24px;\r\n        text-align:center;\r\n        border-style: none;\r\n        line-height: 30px;\r\n        background:transparent;\r\n        cursor: pointer;\r\n        user-select: none;\r\n      }\r\n      .back:focus-visible,\r\n      .config:focus-visible,\r\n      .forward:focus-visible{\r\n        outline: 2px solid blue;\r\n        border-radius: 5px;\r\n        outline-offset: -5px;\r\n      }\r\n      .back.invalid,\r\n      .forward.invalid{\r\n        color:#aaa;\r\n        cursor: auto;\r\n      }\r\n      .back:hover,\r\n      .config:hover,\r\n      .forward:hover{\r\n        border-radius:50%;\r\n        background:#ddd;\r\n      }\r\n      .back.invalid:hover,\r\n      .forward.invalid:hover{\r\n        border-radius:0px;\r\n        background:none;\r\n      }\r\n      .hidden {\r\n        display:none!important;\r\n      }\r\n      .config-container {\r\n        display: flex;\r\n        position: absolute;\r\n        flex-flow: column;\r\n        padding: 5px;\r\n        border: 1px solid;\r\n        border-radius: 5px 0 5px 5px;\r\n        background:white;\r\n        right: 6px;\r\n        top: 40px;\r\n        user-select:none;\r\n      }\r\n      .config-container:after {\r\n        content: \"\";\r\n        position: absolute;\r\n        width: 10px;\r\n        height: 10px;\r\n        right: 2px;\r\n        top: -6px;\r\n        border-style: solid;\r\n        background: white;\r\n        border-width: 1px 0 0 1px;\r\n        transform: rotate(45deg);\r\n      }\r\n    </style>\r\n  `;\r\n  const container = document.createElement(\"div\");\r\n  const header = document.createElement(\"header\");\r\n  const iframe = document.createElement(\"iframe\");\r\n  const configButton = document.createElement(\"button\");\r\n  const forwardButton = document.createElement(\"button\");\r\n  const backButton = document.createElement(\"button\");\r\n  const configContainer = document.createElement(\"form\");\r\n  getStorageByArray([\"openSelection\", \"hiddenChinese\"], (item) => {\r\n    configContainer.innerHTML = `\r\n      <label >启用选词翻译<input type=\"checkbox\" name=\"${openSelection}\" ${\r\n      item.openSelection ? \"checked\" : \"\"\r\n    }/></label>\r\n      <label >隐藏中文翻译<input type=\"checkbox\" name=\"${hiddenChinese}\" ${\r\n      item.hiddenChinese ? \"checked\" : \"\"\r\n    }/></label>`;\r\n  });\r\n\r\n  configButton.textContent = \"∨\";\r\n  forwardButton.textContent = \"＞\";\r\n  backButton.textContent = \"＜\";\r\n  header.append(backButton, forwardButton, configButton, configContainer);\r\n  container.append(header, iframe);\r\n  shadowRoot.append(container);\r\n  header.classList.add(\"header\");\r\n  iframe.classList.add(\"iframe\");\r\n  container.classList.add(\"container\");\r\n  backButton.classList.add(\"back\", \"invalid\");\r\n  configButton.classList.add(\"config\");\r\n  forwardButton.classList.add(\"forward\", \"invalid\");\r\n  configContainer.classList.add(\"config-container\", \"hidden\");\r\n\r\n  //部分页面为了避免广告插入，会在设置一个类似 iframe {display:none!important} 的样式\r\n  //所为了避免受到影响，就需要添加下面这一行\r\n  iframe.style.setProperty(\"display\", \"block\", \"important\");\r\n\r\n  return {\r\n    container: container,\r\n    iframe: iframe,\r\n    forwardButton: forwardButton,\r\n    backButton: backButton,\r\n    configContainer: configContainer,\r\n    configButton: configButton,\r\n    wrapper: wrapper,\r\n  };\r\n}\r\n","export function setBadgeText(\r\n  details: chrome.browserAction.BadgeTextDetails,\r\n  callback?: () => void\r\n) {\r\n  chrome.browserAction.setBadgeText(details, callback);\r\n}\r\n","//此处的值与 manifest 中 command对象的键相关\r\ntype Command =\r\n  | \"open_search_box\"\r\n  | \"show_translation_page\"\r\n  | \"switch_hotkey_and_selection_listener\";\r\n\r\ntype HandlerObject = Record<Command, () => void>;\r\nlet onCommand = function onCommand(handlerObject: HandlerObject) {\r\n  //监听用户快捷键，用于开关拓展\r\n  chrome.commands.onCommand.addListener(function (command) {\r\n    const handler = handlerObject[command as Command];\r\n    handler?.();\r\n  });\r\n};\r\n\r\nif (__DEV__) {\r\n  onCommand = function StrictOnCommand(handlerObject: HandlerObject) {\r\n    const { commands } = chrome.runtime.getManifest();\r\n    if (!commands) throw new Error(\"manifest.json 文件中没有 commands 项\");\r\n    const commandNames = Object.keys(handlerObject);\r\n    commandNames.forEach(function (command) {\r\n      if (!(command in commands))\r\n        throw new Error(`没有在 commands 中找到 ${command} 项`);\r\n    });\r\n    //监听用户快捷键，用于开关拓展\r\n    chrome.commands.onCommand.addListener(function (command) {\r\n      const handler = handlerObject[command as Command];\r\n      handler?.();\r\n    });\r\n  };\r\n}\r\n\r\nexport { onCommand };\r\n","export function addContextMenuItem(\r\n  createProperties: chrome.contextMenus.CreateProperties,\r\n  callback?: () => void\r\n) {\r\n  chrome.contextMenus.create(createProperties, callback);\r\n}\r\n\r\nexport function onContextMenuClick(\r\n  callback: (\r\n    info: chrome.contextMenus.OnClickData,\r\n    tab?: chrome.tabs.Tab\r\n  ) => void\r\n) {\r\n  chrome.contextMenus.onClicked.addListener(callback);\r\n}\r\n","export {\r\n  getStorageByArray,\r\n  getStorageByObject,\r\n  setStorage,\r\n  onStorageChange,\r\n} from \"./storage\";\r\n\r\nexport { onCommand } from \"./commands\";\r\nexport { setBadgeText } from \"./browserAction\";\r\nexport { executeScript, postFrontend } from \"./tabs\";\r\nexport { addContextMenuItem, onContextMenuClick } from \"./contextMenus\";\r\nexport { postBackend, onMessage, getURL, openOptionsPage } from \"./runtime\";\r\nexport { TabPanelName } from \"./types\";\r\nexport type {\r\n  Storage,\r\n  WordFields,\r\n  ModelFields,\r\n  PhraseFields,\r\n  SentenceFields,\r\n  WordConfig,\r\n  PhraseConfig,\r\n  CommonConfig,\r\n  SentenceConfig,\r\n  CheckWordDuplicate,\r\n  CheckPhraseDuplicate,\r\n  CheckSentenceDuplicate,\r\n  ConfigKeys,\r\n  DuplicateConfigKeys,\r\n} from \"./types\";\r\n","import { Command } from \"@/configuration\";\r\nimport { ShowData, Point } from \"@/types\";\r\nimport { NoteData } from \"@/translation-page\";\r\nimport {\r\n  AddNoteReturnType,\r\n  GetVersionReturnType,\r\n  RelearnCardsReturnType,\r\n  GetDeckNamesReturnType,\r\n  GetModelNamesReturnType,\r\n  GetModelFieldNamesReturnType,\r\n} from \"@/anki\";\r\nimport { TranslationResult } from \"@/dictionary\";\r\nexport function getURL(name: string) {\r\n  return chrome.runtime.getURL(name);\r\n}\r\n\r\nexport function openOptionsPage(callback?: () => void) {\r\n  chrome.runtime.openOptionsPage(callback);\r\n}\r\n\r\nexport type SendResponse = Parameters<\r\n  Parameters<typeof chrome.runtime.onMessage.addListener>[\"0\"]\r\n>[\"2\"];\r\n\r\n//向后端发送消息的函数\r\nexport async function postBackend(\r\n  command: Command.GetDeckNames\r\n): Promise<GetDeckNamesReturnType>;\r\nexport async function postBackend(\r\n  command: Command.GetModelNames\r\n): Promise<GetModelNamesReturnType>;\r\nexport async function postBackend(\r\n  command: Command.GetVersion\r\n): Promise<GetVersionReturnType>;\r\nexport async function postBackend(\r\n  command: Command.GetModelFieldNames,\r\n  data: string\r\n): Promise<GetModelFieldNamesReturnType>;\r\nexport async function postBackend(\r\n  command: Command.AddNote,\r\n  data: NoteData\r\n): Promise<AddNoteReturnType>;\r\nexport async function postBackend(\r\n  command: Command.RelearnNote,\r\n  data: number[]\r\n): Promise<RelearnCardsReturnType>;\r\nexport async function postBackend(\r\n  command: Command.TranslateText,\r\n  data: string\r\n): Promise<TranslationResult>;\r\nexport async function postBackend(\r\n  command: Command.TranslateInjectText,\r\n  data: { text: string; point: Point }\r\n): Promise<void>;\r\nexport async function postBackend(command: Command, data?: any): Promise<any> {\r\n  return new Promise((resolve) => {\r\n    chrome.runtime.sendMessage({ command, data }, function (response) {\r\n      resolve(response);\r\n    });\r\n  });\r\n}\r\n\r\ninterface Handler {\r\n  (args: {\r\n    command: Command.ShowInjectTranslation;\r\n    data: Required<ShowData>;\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.TranslateInjectText;\r\n    data: { text: string; point: Point };\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.OpenSearchBox;\r\n    data: undefined;\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.ShowIframe;\r\n    data: undefined;\r\n    sendResponse: () => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetVersion;\r\n    data: undefined;\r\n    sendResponse: (data: GetVersionReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetDeckNames;\r\n    data: undefined;\r\n    sendResponse: (data: GetDeckNamesReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetModelNames;\r\n    data: undefined;\r\n    sendResponse: (data: GetModelNamesReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.GetModelFieldNames;\r\n    data: string;\r\n    sendResponse: (data: GetModelFieldNamesReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.AddNote;\r\n    data: NoteData;\r\n    sendResponse: (data: AddNoteReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.RelearnNote;\r\n    data: number[];\r\n    sendResponse: (data: RelearnCardsReturnType) => void;\r\n  }): Promise<void>;\r\n  (args: {\r\n    command: Command.TranslateText;\r\n    data: string;\r\n    sendResponse: (data: TranslationResult) => void;\r\n  }): Promise<void>;\r\n}\r\n//监听拓展不同模块间消息传递的函数\r\nexport function onMessage(handler: Handler) {\r\n  chrome.runtime.onMessage.addListener(function (\r\n    message,\r\n    sender,\r\n    _sendResponse\r\n  ) {\r\n    //主要用于消除因为 return true,但却没有调用 sendResponse 而造成的报错。\r\n    let called = false;\r\n    handler({\r\n      ...message,\r\n      sendResponse(...args: any[]) {\r\n        called = true;\r\n        return _sendResponse(...args);\r\n      },\r\n    }).then(function () {\r\n      if (called) return;\r\n\r\n      _sendResponse();\r\n    });\r\n    return true; //为了使sendResponse可以异步调用，这是必须的\r\n  });\r\n}\r\n","import pick from \"lodash.pick\";\r\nimport { DEFAULT_ANKI_CONNECTION_URL } from \"@/configuration\";\r\nimport { Storage, TabPanelName, PartialStorage } from \"./types\";\r\n\r\n//缓存默认值对象，用于在用户刚刚加载拓展，没有进行任何配置时作为初始配置。\r\n//确保 Storage 中的缓存无论何时都是符合要求的，不存在刚刚加载插件时因为 Storage 为空而导致的问题。\r\nconst defaultStorage: Storage = {\r\n  switchHotkeyAndSelectionListener: true,\r\n  hotKey: \"shiftKey\",\r\n  openSelection: true,\r\n  hiddenChinese: false,\r\n  checkedTabPanel: TabPanelName.Home,\r\n  ankiConnectionMethod: \"AnkiConnection\",\r\n  ankiConnectionURL: DEFAULT_ANKI_CONNECTION_URL,\r\n  switchStrengthenSelectionByPressedCtrl: true,\r\n  wordConfig: {},\r\n  phraseConfig: {},\r\n  sentenceConfig: {},\r\n\r\n  checkWordDuplicate: {\r\n    word: true,\r\n    deckName: true,\r\n    definition: true,\r\n    translation: true,\r\n  },\r\n  checkPhraseDuplicate: {\r\n    phrase: true,\r\n    deckName: true,\r\n  },\r\n  checkSentenceDuplicate: {\r\n    deckName: true,\r\n    sentence: true,\r\n  },\r\n};\r\n\r\ntype StorageKeys = keyof Storage;\r\n\r\ntype StorageHandlers<T extends PartialStorage> = {\r\n  [P in keyof T]?: (value: T[P]) => void;\r\n};\r\n\r\ntype StorageToCallback<T extends PartialStorage> = {\r\n  [P in keyof T]?: (oldVal: T[P], newVal: T[P]) => void;\r\n};\r\n\r\ntype GetStorageCallback = (storage: PartialStorage) => void;\r\n\r\nfunction handlersIsArray(\r\n  handlers: StorageHandlers<Storage> | StorageKeys[]\r\n): handlers is StorageKeys[] {\r\n  return Array.isArray(handlers);\r\n}\r\n\r\nfunction getStorage<K extends StorageKeys>(\r\n  handlers: K[],\r\n  callback: (storage: Pick<Storage, K>) => void\r\n): void;\r\nfunction getStorage(\r\n  handlers: StorageHandlers<Storage>,\r\n  callback?: GetStorageCallback\r\n): void;\r\nfunction getStorage<K extends StorageKeys>(\r\n  handlers: StorageHandlers<Storage> | K[],\r\n  callback?: (storage: Pick<Storage, K>) => void\r\n) {\r\n  const storageKeys = handlersIsArray(handlers)\r\n    ? handlers\r\n    : (Object.keys(handlers) as StorageKeys[]);\r\n  const storage = pick(defaultStorage, storageKeys);\r\n  chrome.storage.local.get(storage, (storage: PartialStorage) => {\r\n    if (!handlersIsArray(handlers)) {\r\n      Object.keys(storage).forEach((key) => {\r\n        const handler = handlers[key as StorageKeys];\r\n        const cacheValue = storage[key as StorageKeys];\r\n        //@ts-ignore 是匹配的值\r\n        handler?.(cacheValue);\r\n      });\r\n    }\r\n    callback?.(storage as Pick<Storage, K>);\r\n  });\r\n}\r\n\r\nexport function getStorageByArray<K extends StorageKeys>(\r\n  names: K[],\r\n  callback: (storage: Pick<Storage, K>) => void\r\n) {\r\n  getStorage(names, callback);\r\n}\r\n\r\nexport function getStorageByObject(\r\n  handlers: StorageHandlers<Storage>,\r\n  callback?: GetStorageCallback\r\n) {\r\n  getStorage(handlers, callback);\r\n}\r\n\r\nexport function onStorageChange(handlers: StorageToCallback<Storage>) {\r\n  const listener: Parameters<typeof chrome.storage.onChanged.addListener>[0] = (\r\n    changes\r\n  ) => {\r\n    Object.keys(changes).forEach((key) => {\r\n      const handler = handlers[key as StorageKeys];\r\n      if (handler) {\r\n        const { oldValue, newValue } = changes[key]!;\r\n        //@ts-ignore 是正确匹配的\r\n        handler(oldValue, newValue);\r\n      }\r\n    });\r\n  };\r\n  chrome.storage.onChanged.addListener(listener);\r\n  return () => {\r\n    chrome.storage.onChanged.removeListener(listener);\r\n  };\r\n}\r\n\r\nexport function setStorage(\r\n  partialStorage: PartialStorage,\r\n  callback?: () => void\r\n) {\r\n  chrome.storage.local.set(partialStorage, callback);\r\n}\r\n","import { ShowData } from \"@/types\";\r\nimport { Command } from \"@/configuration\";\r\n\r\n//向前端发送消息的函数\r\nexport async function postFrontend(command: Command.ShowIframe): Promise<void>;\r\nexport async function postFrontend(\r\n  command: Command.OpenSearchBox\r\n): Promise<void>;\r\nexport async function postFrontend(\r\n  command: Command.ShowInjectTranslation,\r\n  data: Required<ShowData>\r\n): Promise<void>;\r\nexport async function postFrontend(\r\n  command: Command,\r\n  data?: any\r\n): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    chrome.tabs.query({ active: true }, function (tabs) {\r\n      tabs.forEach((tab) => {\r\n        if (!tab.id) return;\r\n        chrome.tabs.sendMessage(tab.id, { command, data }, function (response) {\r\n          resolve(response);\r\n        });\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nexport function executeScript(\r\n  details: chrome.tabs.InjectDetails,\r\n  callback?: ((result: any[]) => void) | undefined\r\n) {\r\n  chrome.tabs.executeScript(details, callback);\r\n}\r\n","import { HotKey } from \"@/types\";\r\n\r\nexport interface CommonConfig {\r\n  tags: string;\r\n  deckName: string;\r\n  modelName: string;\r\n}\r\n\r\nexport interface WordFields {\r\n  en: string;\r\n  am: string;\r\n  word: string;\r\n  am_audio: string;\r\n  en_audio: string;\r\n  definition: string;\r\n  translation: string;\r\n  star_amount: string;\r\n  example_audio: string;\r\n  part_of_speech: string;\r\n  definition_audio: string;\r\n  example_sentence: string;\r\n  example_sentence_translation: string;\r\n}\r\n\r\nexport interface PhraseFields {\r\n  phrase: string;\r\n  phrase_audio: string;\r\n  translations: string;\r\n  example_audio_1: string;\r\n  example_audio_2: string;\r\n  example_audio_3: string;\r\n  example_sentence_1: string;\r\n  example_sentence_2: string;\r\n  example_sentence_3: string;\r\n  example_sentence_translation_1: string;\r\n  example_sentence_translation_2: string;\r\n  example_sentence_translation_3: string;\r\n}\r\n\r\nexport interface SentenceFields {\r\n  sentence: string;\r\n  sentence_audio: string;\r\n  sentence_translation: string;\r\n}\r\n\r\nexport const enum TabPanelName {\r\n  Home,\r\n  Word,\r\n  Phrase,\r\n  Sentence,\r\n}\r\n\r\nexport type WordConfig = Partial<WordFields & CommonConfig>;\r\nexport type PhraseConfig = Partial<PhraseFields & CommonConfig>;\r\nexport type SentenceConfig = Partial<SentenceFields & CommonConfig>;\r\nexport type ConfigKeys =\r\n  | keyof WordConfig\r\n  | keyof PhraseConfig\r\n  | keyof SentenceConfig;\r\n\r\nexport type CheckWordDuplicate = Partial<\r\n  Record<keyof Omit<WordConfig, \"tags\">, boolean>\r\n>;\r\nexport type CheckPhraseDuplicate = Partial<\r\n  Record<keyof Omit<PhraseConfig, \"tags\">, boolean>\r\n>;\r\nexport type CheckSentenceDuplicate = Partial<\r\n  Record<keyof Omit<SentenceConfig, \"tags\">, boolean>\r\n>;\r\n\r\nexport type DuplicateConfigKeys =\r\n  | keyof CheckWordDuplicate\r\n  | keyof CheckPhraseDuplicate\r\n  | keyof CheckSentenceDuplicate;\r\n\r\nexport type ModelFields =\r\n  | Partial<WordFields>\r\n  | Partial<PhraseFields>\r\n  | Partial<SentenceFields>;\r\n\r\nexport interface Storage {\r\n  switchHotkeyAndSelectionListener: boolean;\r\n  openSelection: boolean;\r\n  hiddenChinese: boolean;\r\n  ankiConnectionURL: string;\r\n  hotKey: HotKey;\r\n  ankiConnectionMethod: string;\r\n  checkedTabPanel: TabPanelName;\r\n  wordConfig: WordConfig;\r\n  phraseConfig: PhraseConfig;\r\n  sentenceConfig: SentenceConfig;\r\n  checkWordDuplicate: CheckWordDuplicate;\r\n  checkPhraseDuplicate: CheckPhraseDuplicate;\r\n  checkSentenceDuplicate: CheckSentenceDuplicate;\r\n  switchStrengthenSelectionByPressedCtrl: boolean;\r\n}\r\n\r\nexport type PartialStorage = Partial<Storage>;\r\n","import type { Point } from \"@/types\";\r\n\r\nexport class CursorListener {\r\n  private clientPoint:Point = { x: 0, y: 0 }\r\n  private screenPoint:Point = { x: 0, y: 0 }\r\n  getClientPoint = () => {\r\n    return this.clientPoint;\r\n  }\r\n  getScreenPoint = () => {\r\n    return this.screenPoint;\r\n  }\r\n  install = () => {\r\n    document.addEventListener(\"mousemove\", this.onMouseMove, true); //避免被阻止冒泡导致失效\r\n  }\r\n  uninstall = () => {\r\n    document.removeEventListener(\"mousemove\", this.onMouseMove, true);\r\n  }\r\n  private onMouseMove = (event: MouseEvent) => {\r\n    const { clientX, clientY, screenY, screenX } = event;\r\n    this.clientPoint = {\r\n      x: clientX,\r\n      y: clientY,\r\n    };\r\n    this.screenPoint = {\r\n      x: screenX,\r\n      y: screenY,\r\n    };\r\n  }\r\n}\r\n","import {\r\n  getSelectionText,\r\n  getRangeFromPoint,\r\n  isContentEditable,\r\n  isSearchContainer,\r\n  UserSelectHandler,\r\n} from \"./utils\";\r\nimport type { HotKey, TranslateAndDisplayText, GetPoint } from \"@/types\";\r\n\r\nexport class HotKeyListener {\r\n  modify;\r\n  restore;\r\n  private hotKey?: HotKey;\r\n  private checkout: RegExp;\r\n  private getPoint: GetPoint;\r\n  private translateAndDisplayText: TranslateAndDisplayText;\r\n\r\n  constructor(\r\n    translateAndDisplayText: TranslateAndDisplayText,\r\n    getPoint: GetPoint\r\n  ) {\r\n    this.getPoint = getPoint;\r\n    this.translateAndDisplayText = translateAndDisplayText;\r\n    this.hotKey = \"shiftKey\";\r\n    this.checkout = /[a-z_]/i;\r\n\r\n    const { modify, restore } = new UserSelectHandler();\r\n    this.modify = modify;\r\n    this.restore = restore;\r\n  }\r\n\r\n  updateHotKey = (hotKey: HotKey | undefined) => {\r\n    this.hotKey = hotKey;\r\n  };\r\n\r\n  install = () => {\r\n    document.addEventListener(\"keydown\", this.onKeyDown);\r\n  };\r\n  uninstall = () => {\r\n    document.removeEventListener(\"keydown\", this.onKeyDown);\r\n    this.restore();\r\n  };\r\n\r\n  private onKeyDown = (event: KeyboardEvent) => {\r\n    const { hotKey } = this;\r\n\r\n    if (hotKey && event[hotKey]) {\r\n      //当焦点在可输入元素上，不进行热键选词\r\n      const focusNode = document.activeElement;\r\n      if (focusNode && isContentEditable(focusNode)) return;\r\n      //这是一个用 div 封装的 input\r\n      if (isSearchContainer(focusNode)) return;\r\n\r\n      const { x, y } = this.getPoint();\r\n      this.autoSelectText(x, y);\r\n      const selectedText = getSelectionText();\r\n      if (!selectedText) return;\r\n      this.translateAndDisplayText(selectedText);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 判断是否符合自动选中条件\r\n   * @param letter 当前需要判断的字母\r\n   * @returns Boolean\r\n   */\r\n  private validate = (letter: string) => {\r\n    if (letter == null) return false;\r\n    return this.checkout.test(letter);\r\n  };\r\n\r\n  /**\r\n   * 根据用户鼠标的当前位置，自动选中符合要求的文本，表现为对应文本拖蓝选中\r\n   * @param x ClientX\r\n   * @param y ClientY\r\n   * @returns\r\n   */\r\n  private autoSelectText = (x: number, y: number) => {\r\n    let range = getRangeFromPoint(x, y);\r\n    if (!range) return;\r\n\r\n    range = this.extendRange(range);\r\n    if (range == null) return;\r\n\r\n    const selection = getSelection();\r\n    if (!selection) return;\r\n\r\n    //避免因为 user-select:none 而导致 热键选中失效\r\n    const target = range.commonAncestorContainer.parentElement;\r\n    if (target != null) {\r\n      this.modify(target);\r\n    }\r\n\r\n    //只有 firefox支持多个拖蓝选中，而其它浏览器不支持，因此如果不先清空原有的range，则后面的添加无效\r\n    selection.removeAllRanges();\r\n    //用拖蓝形式展现被选中的单词\r\n    selection.addRange(range);\r\n  };\r\n\r\n  /**\r\n   * 传入一个 选中文本节点 的 Range对象，\r\n   * 按照一定要求对其进行扩充，\r\n   * 返回一个新的Range\r\n   *\r\n   * @param range Range\r\n   * @returns Range\r\n   */\r\n  private extendRange = (range: Range): Range | null => {\r\n    const textNode = range.startContainer;\r\n    //并非文本节点，退出\r\n    if (!isText(textNode)) return null;\r\n    const limit_left = 0;\r\n    const limit_right = textNode.length;\r\n    const text = textNode.data;\r\n    let { startOffset, endOffset } = range;\r\n\r\n    //如果当前鼠标位置的字符不符合要求，则表明无需进行自动选取\r\n    if (!this.validate(text[startOffset])) return range;\r\n\r\n    while (limit_left <= startOffset) {\r\n      const letter = text[startOffset];\r\n      if (this.validate(letter)) {\r\n        startOffset--;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    //回退到前一个符合要求的字符\r\n    startOffset++;\r\n    //startOffset与endOffset在一开始是相等的，避免重复验证同一个字符\r\n    endOffset++;\r\n    while (endOffset < limit_right) {\r\n      const letter = text[endOffset];\r\n\r\n      if (this.validate(letter)) {\r\n        endOffset++;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    //因为setEnd不包括endOffset，因此不用回退到上一个符合要求的字符\r\n    //但需要注意，避免endOffset超出limit_right\r\n    endOffset = Math.min(limit_right, endOffset);\r\n    const newRange = new Range();\r\n    newRange.setStart(textNode, startOffset);\r\n    newRange.setEnd(textNode, endOffset);\r\n    return newRange;\r\n  };\r\n}\r\n\r\nfunction isText(node: Node): node is Text {\r\n  return node.nodeType === 3;\r\n}\r\n","/**\r\n * 允许用户通过搜索栏主动输入单词，而后对单词进行查询\r\n */\r\nimport { attachSymbolToSearchContainer } from \"./utils\";\r\nimport type { TranslateAndDisplayText } from \"@/types\";\r\n\r\nexport class SearchBox {\r\n  openSearchBox;\r\n  closeSearchBox;\r\n  private container;\r\n\r\n  constructor(translateAndDisplayText: TranslateAndDisplayText) {\r\n    const { container, openSearchBox, closeSearchBox } = createSearchBar(\r\n      translateAndDisplayText\r\n    );\r\n    this.container = container;\r\n    this.openSearchBox = openSearchBox;\r\n    this.closeSearchBox = closeSearchBox\r\n  }\r\n  install = () => {\r\n    document.body.append(this.container);\r\n  };\r\n  uninstall = () => {\r\n    this.closeSearchBox()\r\n    this.container.remove();\r\n  }\r\n}\r\n\r\nconst FORM_ID = \"search-form\";\r\nconst INPUT_ID = \"search-input\";\r\nconst BUTTON_ID = \"search-button\";\r\n/**\r\n * 创建搜索条\r\n */\r\nfunction createSearchBar(translateAndDisplayText: TranslateAndDisplayText) {\r\n  const container = document.createElement(\"div\");\r\n  attachSymbolToSearchContainer(container);\r\n  //实现幽灵节点\r\n  container.style.setProperty(\"display\", \"contents\", \"important\");\r\n  const shadow = container.attachShadow({\r\n    mode: \"open\",\r\n  });\r\n  shadow.innerHTML = `\r\n    <style>\r\n      #${FORM_ID} {\r\n        display:none;\r\n        box-sizing: border-box;\r\n        position: fixed;\r\n        z-index: 99999;\r\n        left: 50%;     \r\n        right: 0;       \r\n        top: 10vh;\r\n        margin: auto;\r\n        min-width: 200px;\r\n        width: 25%;\r\n        border: 1px solid #666;\r\n        border-radius: 5px;\r\n        background:white;\r\n        box-shadow: 1px 1px 2px -1px #333;\r\n      }\r\n      #${INPUT_ID} {\r\n        flex: 1;\r\n        box-sizing: border-box;\r\n        width: 100%;\r\n        border: none;\r\n        border-radius: 5px 0 0 5px;\r\n        padding: 0 10px;\r\n        outline: none;\r\n        font-size: 16px;\r\n        line-height: 2;\r\n      }\r\n      #${BUTTON_ID} {\r\n        font-size: 28px;\r\n        line-height: 1;\r\n        border: none;\r\n        border-radius: 0 5px 5px 0;\r\n        background: white;\r\n        outline:none;\r\n      }\r\n      #${BUTTON_ID}:hover,\r\n      #${BUTTON_ID}:focus {\r\n        background: #e6e6e6;\r\n      }\r\n      .vertical {\r\n        width: 1px;\r\n        background: #666;\r\n        margin: 3px 0;\r\n      }\r\n    </style>    \r\n    <form action=\"#\" autocomplete=\"off\" id=\"${FORM_ID}\">\r\n      <input type=\"text\" id=\"${INPUT_ID}\"/>\r\n      <span class=\"vertical\"></span>\r\n      <button type=\"button\" id=\"${BUTTON_ID}\">×</button>\r\n    </form>\r\n  `;\r\n  const form = shadow.getElementById(FORM_ID) as HTMLFormElement;\r\n  const input = shadow.getElementById(INPUT_ID) as HTMLInputElement;\r\n  const button = shadow.getElementById(BUTTON_ID) as HTMLButtonElement;\r\n  //绑定事件监听\r\n  //当用户按下enter键时进行查询\r\n  form.addEventListener(\"submit\", function (event) {\r\n    event.preventDefault();\r\n    var text = input.value.trim();\r\n    if (text) {\r\n      translateAndDisplayText(text);\r\n    }\r\n  });\r\n\r\n  button.addEventListener(\"click\", closeSearchBox);\r\n\r\n  function closeSearchBox() {\r\n    input.value = \"\";\r\n    form.style.display = \"none\";\r\n  }\r\n\r\n  function openSearchBox() {\r\n    form.style.display = \"flex\";\r\n    input.focus();\r\n    input.select();\r\n  }\r\n\r\n  return {\r\n    container,\r\n    openSearchBox,\r\n    closeSearchBox,\r\n  };\r\n}\r\n","/**\r\n * 双击选中翻译事件\r\n */\r\nimport {\r\n  getSelectionText,\r\n  isContentEditable,\r\n  isSearchContainer,\r\n} from \"./utils\";\r\n\r\nimport type{ TranslateAndDisplayText } from \"@/types\";\r\n\r\nexport class SelectionListener {\r\n  private enableCtrl = true;\r\n  private selectionChanged = false;\r\n  private translateAndDisplayText: TranslateAndDisplayText;\r\n\r\n  constructor(translateAndDisplayText: TranslateAndDisplayText) {\r\n    this.translateAndDisplayText = translateAndDisplayText;\r\n  }\r\n\r\n  install = () => {\r\n    document.addEventListener(\"mousedown\", this.onMouseDown);\r\n    document.addEventListener(\"mouseup\", this.onMouseUp);\r\n  };\r\n  uninstall = () => {\r\n    document.removeEventListener(\"mousedown\", this.onMouseDown);\r\n    document.removeEventListener(\"mouseup\", this.onMouseUp);\r\n  };\r\n\r\n  /**\r\n   * @param value true,使得用户能够在按住 Ctrl键进行选取时，可以翻译 可输入元素内部的文本，false则是不可以\r\n   */\r\n  switchStrengthenSelectionByPressedCtrl = (value: boolean) =>{\r\n    this.enableCtrl = value;\r\n  }\r\n\r\n  private onMouseDown = () => {\r\n    document.addEventListener(\"selectionchange\", this.onSelectionChange, {\r\n      once: true,\r\n    });\r\n  };\r\n\r\n  private onSelectionChange = () => {\r\n    this.selectionChanged = true;\r\n  };\r\n\r\n  /**\r\n   * 当用户拖蓝选取文本时，鼠标抬起是进行查询的时间\r\n   * 当用户双击选取文本时，鼠标抬起也是进行查询的时机\r\n   * @returns void\r\n   */\r\n  private onMouseUp = (event: MouseEvent) => {\r\n    if (!this.selectionChanged) {\r\n      document.removeEventListener(\"selectionchange\", this.onSelectionChange);\r\n      return;\r\n    }\r\n\r\n    this.selectionChanged = false;\r\n    const selectedText = getSelectionText();\r\n    if (!selectedText) return;\r\n\r\n    const hotKey = event.ctrlKey;\r\n    const focusNode = document.activeElement;\r\n    //判断是否跳过对于可编辑元素的过滤\r\n    if (!(this.enableCtrl && hotKey)) {\r\n      //不对输入框中的文本进行选中翻译\r\n      if (focusNode && isContentEditable(focusNode)) return;\r\n    }\r\n    if (isSearchContainer(focusNode)) return;\r\n\r\n    this.translateAndDisplayText(selectedText);\r\n  };\r\n}\r\n","export { SearchBox } from \"./SearchBox\";//创建一个搜索框，允许用户搜索\r\nexport { CursorListener } from \"./CursorListener\";//实时监听鼠标位置\r\nexport { HotKeyListener } from \"./HotKeyListener\";//监听用户热键选词翻译的操作\r\nexport { SelectionListener } from \"./SelectionListener\";//监听用户双击、拖蓝选中翻译的操作\r\n","const USER_SELECT = \"user-select\";\r\n\r\nexport class UserSelectHandler {\r\n  modifiedHTMLElements: Map<HTMLElement, [string, string]> = new Map();\r\n  modify = (element: HTMLElement) => {\r\n    const modifiedHTMLElements = this.modifiedHTMLElements;\r\n    if (!modifiedHTMLElements.has(element)) {\r\n      var userSelectValue = element.style.getPropertyValue(USER_SELECT);\r\n      var userSelectPriority = element.style.getPropertyPriority(USER_SELECT);\r\n      modifiedHTMLElements.set(element, [userSelectValue, userSelectPriority]);\r\n      element.style.setProperty(USER_SELECT, \"text\", \"important\");\r\n    }\r\n  };\r\n  restore = () => {\r\n    const modifiedHTMLElements = this.modifiedHTMLElements;\r\n    modifiedHTMLElements.forEach(function ([value, priority], element) {\r\n      element.style.setProperty(USER_SELECT, value, priority);\r\n    });\r\n    modifiedHTMLElements.clear();\r\n  };\r\n}\r\n\r\n","/**\r\n * 对 document.caretPositionFromPoint/caretRangeFromPoint 进行浏览器兼容处理\r\n * @param x clientX\r\n * @param y clientY\r\n * @returns Range\r\n */\r\n export function getRangeFromPoint(x: number, y: number): Range | null {\r\n  if (\"caretRangeFromPoint\" in document) {\r\n    return document.caretRangeFromPoint(x, y)\r\n  }\r\n\r\n  if (\"caretPositionFromPoint\" in document) {\r\n    //@ts-ignore 该方法存在于firefox\r\n    let caretPosition = document.caretPositionFromPoint(x, y)\r\n    if (!caretPosition) return null\r\n    let { offsetNode, offset } = caretPosition\r\n    let range = document.createRange()\r\n    range.setStart(offsetNode, offset)\r\n    return range\r\n  }\r\n  if (__DEV__) {\r\n    throw new Error(\"没有在 document 上找到 'caretPositionFromPoint' 或者 'caretRangeFromPoint' 方法，无法实现热键选中功能。\")\r\n  }\r\n  return null\r\n}","export function getSelectionText(): string | undefined {\r\n  let selection = getSelection()\r\n  return selection?.toString().trim()\r\n}","export { getSelectionText } from \"./getSelectionText\";\r\nexport { getRangeFromPoint } from \"./getRangeFromPoint\";\r\nexport { isContentEditable } from \"./isContentEditable\";\r\nexport { UserSelectHandler } from \"./UserSelectHandler\";\r\nexport {\r\n  isSearchContainer,\r\n  attachSymbolToSearchContainer,\r\n} from \"./verifySearchContainer\";\r\n","export function isContentEditable(element:Element) {\r\n  if ([\"INPUT\", \"TEXTAREA\"].includes(element.tagName)) return true;\r\n  if (element instanceof HTMLElement && element.isContentEditable) return true;\r\n  return false;\r\n}","const SEARCH_CONTAINER_ID = \"ANKI_BROWSER_EXTENSIONS_SEARCH_CONTAINER_ID\";\r\nconst ATTRIBUTE_NAME = \"ANKI_BROWSER_EXTENSIONS_SEARCH_CONTAINER_ATTRIBUTE_NAME\"\r\n\r\nexport function isSearchContainer(element:unknown) {\r\n  if (element == null) return false;\r\n  if (!(element instanceof HTMLElement)) return false\r\n  return element.getAttribute(ATTRIBUTE_NAME) === SEARCH_CONTAINER_ID;\r\n}\r\n\r\nexport function attachSymbolToSearchContainer(element:Element) {\r\n  element.setAttribute(ATTRIBUTE_NAME, SEARCH_CONTAINER_ID);\r\n}","/**\r\n * 对 window.addEventListener(\"message\",callback) 与 window.postMessage 进行二次封装，\r\n *  使window.postMessage具备回调函数功能\r\n */\r\n\r\nimport { FunctionAny } from \"@/types\";\r\nimport { Command } from \"@/configuration\";\r\nimport { warning, invariant } from \"@/utils\";\r\nimport { NoteData } from \"@/translation-page\";\r\nimport { TranslationResult } from \"@/dictionary\";\r\nimport { AddNoteReturnType, RelearnCardsReturnType } from \"@/anki\";\r\n\r\nlet uniqueId = 1;\r\nconst CALLBACK = \"CALLBACK\";\r\n\r\ninterface MessageData {\r\n  command: Command;\r\n  //可选\r\n  data?: any;\r\n  callbackName?: number;\r\n}\r\nexport type PostMessage = Messenger[\"postMessage\"];\r\nexport type OnMessage = Messenger[\"onMessage\"];\r\nexport class Messenger {\r\n  target?: Window;\r\n  self: Window;\r\n  callbacks: { [key: number]: FunctionAny };\r\n  handlers: { [key: string]: FunctionAny[] };\r\n\r\n  constructor(options: { self: Window; target?: Window }) {\r\n    this.self = options.self;\r\n    this.target = options.target;\r\n    this.handlers = Object.create(null);\r\n    this.callbacks = Object.create(null);\r\n    this.onMessage = this.onMessage.bind(this);\r\n    this.postMessage = this.postMessage.bind(this);\r\n  }\r\n  install = () => {\r\n    const { self } = this;\r\n    self.addEventListener(\"message\", this.handleMessage);\r\n  };\r\n  uninstall = () => {\r\n    const { self } = this;\r\n    self.removeEventListener(\"message\", this.handleMessage);\r\n  };\r\n  addTarget = (target: Window) => {\r\n    this.target = target;\r\n  };\r\n  handleMessage = (event: MessageEvent<MessageData>) => {\r\n    const { target, handlers, callbacks } = this;\r\n    const source = event.source;\r\n    const { data, command, callbackName } = event.data;\r\n    if (target !== source) return;\r\n    const callback = callbackName == null ? null : callbacks[callbackName]; // 注释一\r\n    //执行回调专用指令(回调函数响应)\r\n    //@ts-ignore 内部使用，不对外暴露\r\n    if (command === CALLBACK && callback == null) return;\r\n    //@ts-ignore 内部使用，不对外暴露\r\n    if (command === CALLBACK && callback) {\r\n      callback(data);\r\n      //@ts-ignore 根据 注释一 ,callback 存在，则 callbackName 必定不为 undefined\r\n      delete callbacks[callbackName];\r\n      return;\r\n    }\r\n\r\n    if (__DEV__) {\r\n      warning(\r\n        handlers[command] != null && handlers[command]!.length !== 0,\r\n        `对于指令 ${Command[command]} ,未添加任何处理函数`\r\n      );\r\n    }\r\n\r\n    if (handlers[command] != null) {\r\n      handlers[command]!.forEach((fn) => {\r\n        fn(data, (data: any) => {\r\n          //传递给用户的回调函数，下面是内部发送逻辑\r\n          if (callbackName != null) {\r\n            //只有设置了回调函数的指令调用该方法时才有效。\r\n            //@ts-ignore CALLBACK 为内部使用的，用于触发回调\r\n            this.postMessage(CALLBACK, data, callbackName);\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  //translation-page listen agent\r\n  onMessage(command: Command.BackHistory, listener: () => void): () => void;\r\n  onMessage(command: Command.ForwardHistory, listener: () => void): () => void;\r\n  onMessage(command: Command.PauseAudio, listener: () => void): () => void;\r\n  onMessage(\r\n    command: Command.OpenSelection,\r\n    listener: (data: boolean) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.HiddenChinese,\r\n    listener: (data: boolean) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.ShowTranslation,\r\n    listener: (data: TranslationResult, callback: () => void) => void\r\n  ): () => void;\r\n\r\n  //agent listen translation-page\r\n  onMessage(\r\n    command: Command.TranslateText,\r\n    listener: (data: string) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.HistoryIndex,\r\n    listener: (data: { index: number; head: number; tail: number }) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.RelearnNote,\r\n    listener: (\r\n      data: number[],\r\n      callback: (data: RelearnCardsReturnType) => void\r\n    ) => void\r\n  ): () => void;\r\n  onMessage(\r\n    command: Command.AddNote,\r\n    listener: (\r\n      data: NoteData,\r\n      callback: (data: AddNoteReturnType) => void\r\n    ) => void\r\n  ): () => void;\r\n  onMessage(command: Command, listener: FunctionAny): () => void {\r\n    const handlers = this.handlers;\r\n\r\n    if (handlers[command] == null) {\r\n      handlers[command] = [listener];\r\n    } else {\r\n      handlers[command]!.push(listener);\r\n    }\r\n    //单例\r\n    let called = false;\r\n    return function () {\r\n      if (called) return;\r\n      called = true;\r\n      handlers[command] = handlers[command]!.filter((fn) => {\r\n        return fn !== listener;\r\n      });\r\n    };\r\n  }\r\n  //agent to translation-page\r\n  postMessage(command: Command.PauseAudio): void;\r\n  postMessage(command: Command.BackHistory): void;\r\n  postMessage(command: Command.ForwardHistory): void;\r\n  postMessage(command: Command.OpenSelection, data: boolean): void;\r\n  postMessage(command: Command.HiddenChinese, data: boolean): void;\r\n  postMessage(\r\n    command: Command.ShowTranslation,\r\n    data: TranslationResult,\r\n    callback: () => void\r\n  ): void;\r\n  // translation-page to agent\r\n  postMessage(command: Command.TranslateText, data: string): void;\r\n  postMessage(\r\n    command: Command.HistoryIndex,\r\n    data: { index: number; head: number; tail: number }\r\n  ): void;\r\n  postMessage(\r\n    command: Command.RelearnNote,\r\n    data: number[],\r\n    callback: (data: RelearnCardsReturnType) => void\r\n  ): void;\r\n  postMessage(\r\n    command: Command.AddNote,\r\n    data: NoteData,\r\n    callback: (data: AddNoteReturnType) => void\r\n  ): void;\r\n  postMessage(command: Command, data?: any, callback?: FunctionAny): void {\r\n    const target = this.target;\r\n    //此处应该使用报错的 invariant 而非 warning，因为其执行会添加回调函数，如果不报错属于内存泄漏\r\n    if (!target) {\r\n      invariant(false, \"target 不存在，其在通信中是必须的\");\r\n    }\r\n    /* 因为浏览器的postMessage不提供原生的响应回调功能，因此需要自定义实现\r\n     * 设置回调时:(postMessage)\r\n     *   如果存在回调函数，则创建一个唯一的ID保存该回调函数\r\n     *   该唯一ID保存在 data.callbackName 中，随请求携带\r\n     * 执行回调时:(onMessage)\r\n     *   定义收到command为\"callback\"的指令时，调用缓存的回调函数\r\n     *   该指令的data[callbackName]应该有值，通过该值进行正确的回调匹配\r\n     */\r\n    //确保data是引用数据类型\r\n    const message: MessageData = Object.create(null);\r\n    message.data = data;\r\n    message.command = command;\r\n    //如果传递的是number，则说明该次调用是为了触发回调，因为标识是number，所以此处判断number\r\n    //与用户无关，是触发回调的内部逻辑\r\n    if (typeof callback === \"number\") {\r\n      message.callbackName = callback;\r\n    }\r\n\r\n    if (typeof callback === \"function\") {\r\n      const callbackName = uniqueId;\r\n      this.callbacks[callbackName] = callback;\r\n      message.callbackName = callbackName;\r\n      uniqueId++; //保证唯一性\r\n    }\r\n\r\n    target.postMessage(message, \"*\");\r\n  }\r\n}\r\n","/**\r\n * invariant 与 warning 的名称不应该改变，其会被 babel的 \"babel-plugin-dev-expression\" 插件替换，\r\n *  具体可看：\"https://www.npmjs.com/package/babel-plugin-dev-expression\"\r\n */\r\n\r\nexport function invariant(cond: boolean, message: string): asserts cond {\r\n  if (!cond) throw new Error(message);\r\n}\r\n\r\nexport function warning(cond: boolean, message: string) {\r\n  if (!cond) {\r\n    if (typeof console !== \"undefined\") console.warn(message);\r\n\r\n    try {\r\n      //这样的写法是为了便于调试，能够使其支持 “在遇到异常时暂停”（如果选中该调试功能的话）\r\n      throw new Error(message);\r\n      // eslint-disable-next-line no-empty\r\n    } catch (e) {}\r\n  }\r\n}\r\n","export { invariant, warning } from \"./alert\";\r\nexport { validateText } from \"./validateText\";\r\nexport { Messenger } from \"./Messenger\";\r\nexport type { PostMessage, OnMessage } from \"./Messenger\";\r\n\r\n/**\r\n * 纯函数，Object.entries()的单一版本，只提取单个键的[key,value]\r\n */\r\nexport function extractEntry<T extends object, K extends keyof T>(\r\n  target: T,\r\n  key: K\r\n): [K, T[K]] {\r\n  return [key, target[key]];\r\n}\r\n","/**\r\n * 纯函数，过滤掉无效查询\r\n *  - 字符串为空的情况\r\n *  - 查询主体并非英文\r\n * @param text\r\n * @return 返回过滤后的字符，该字符应当是符合查询要求的\r\n */\r\n export function validateText(text: string) {\r\n  text = text.trim();\r\n\r\n  //过滤为空的字符串\r\n  if (!text) return false;\r\n\r\n  //如果英文字母数量不足百分之五十，则认为其并非需要查询的内容\r\n  const amount = text.match(/\\b[a-z]+\\b/gi)?.reduce((amount, item) => {\r\n    return amount + item.length;\r\n  }, 0);\r\n  if (!amount || amount / text.length < 0.5) return false;\r\n\r\n  //过滤用户对URL的复制的查询\r\n  if (text.search(/http:|https:/gi) === 0) return false;\r\n\r\n  return true;\r\n}\r\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0,\n    MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    symbolTag = '[object Symbol]';\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\n/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * The base implementation of `_.flatten` with support for restricting flattening.\n *\n * @private\n * @param {Array} array The array to flatten.\n * @param {number} depth The maximum recursion depth.\n * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n * @param {Array} [result=[]] The initial result value.\n * @returns {Array} Returns the new flattened array.\n */\nfunction baseFlatten(array, depth, predicate, isStrict, result) {\n  var index = -1,\n      length = array.length;\n\n  predicate || (predicate = isFlattenable);\n  result || (result = []);\n\n  while (++index < length) {\n    var value = array[index];\n    if (depth > 0 && predicate(value)) {\n      if (depth > 1) {\n        // Recursively flatten arrays (susceptible to call stack limits).\n        baseFlatten(value, depth - 1, predicate, isStrict, result);\n      } else {\n        arrayPush(result, value);\n      }\n    } else if (!isStrict) {\n      result[result.length] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.pick` without support for individual\n * property identifiers.\n *\n * @private\n * @param {Object} object The source object.\n * @param {string[]} props The property identifiers to pick.\n * @returns {Object} Returns the new object.\n */\nfunction basePick(object, props) {\n  object = Object(object);\n  return basePickBy(object, props, function(value, key) {\n    return key in object;\n  });\n}\n\n/**\n * The base implementation of  `_.pickBy` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The source object.\n * @param {string[]} props The property identifiers to pick from.\n * @param {Function} predicate The function invoked per property.\n * @returns {Object} Returns the new object.\n */\nfunction basePickBy(object, props, predicate) {\n  var index = -1,\n      length = props.length,\n      result = {};\n\n  while (++index < length) {\n    var key = props[index],\n        value = object[key];\n\n    if (predicate(value, key)) {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = array;\n    return apply(func, this, otherArgs);\n  };\n}\n\n/**\n * Checks if `value` is a flattenable `arguments` object or array.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n */\nfunction isFlattenable(value) {\n  return isArray(value) || isArguments(value) ||\n    !!(spreadableSymbol && value && value[spreadableSymbol]);\n}\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Creates an object composed of the picked `object` properties.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The source object.\n * @param {...(string|string[])} [props] The property identifiers to pick.\n * @returns {Object} Returns the new object.\n * @example\n *\n * var object = { 'a': 1, 'b': '2', 'c': 3 };\n *\n * _.pick(object, ['a', 'c']);\n * // => { 'a': 1, 'c': 3 }\n */\nvar pick = baseRest(function(object, props) {\n  return object == null ? {} : basePick(object, arrayMap(baseFlatten(props, 1), toKey));\n});\n\nmodule.exports = pick;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {\r\n  SearchBox,\r\n  CursorListener,\r\n  HotKeyListener,\r\n  SelectionListener,\r\n} from \"@/user-operation\";\r\nimport { Agent } from \"./Agent\";\r\nimport { ShowData } from \"@/types\";\r\nimport { Command } from \"@/configuration\";\r\nimport {\r\n  onMessage,\r\n  postBackend,\r\n  onStorageChange,\r\n  getStorageByObject,\r\n} from \"@/extensions-api\";\r\nimport { validateText } from \"@/utils\";\r\n\r\n//监听用户操作\r\nconst cursorListener = new CursorListener();\r\nconst { getClientPoint } = cursorListener;\r\nconst searchBox = new SearchBox(translateAndShowSearchText);\r\nconst selectionListener = new SelectionListener(translateAndShowText);\r\nconst hotKeyListener = new HotKeyListener(translateAndShowText, getClientPoint);\r\ncursorListener.install();\r\nsearchBox.install();\r\n\r\n//监听iframe传递的指令并进行处理\r\nconst agent = new Agent();\r\nagent.onMessage(Command.AddNote, async (data, sendResponse) => {\r\n  const response = await postBackend(Command.AddNote, data);\r\n  sendResponse(response);\r\n});\r\nagent.onMessage(Command.RelearnNote, async (data, sendResponse) => {\r\n  const response = await postBackend(Command.RelearnNote, data);\r\n  sendResponse(response);\r\n});\r\nagent.onMessage(Command.TranslateText, function (data) {\r\n  translateAndShowIframeText(data);\r\n});\r\nagent.install();\r\n\r\n/**\r\n * 用于处理注入脚本的翻译，其特别之处在于其point相对于浏览器窗口左上角而非视口左上角，因此需要额外的调整\r\n */\r\nfunction showInjectScriptTranslationText(data: Required<ShowData>) {\r\n  let { x, y } = data.point;\r\n  //此处的x,y是鼠标相对于屏幕左上角的坐标，需要将其装换为：鼠标相对于浏览器左上角的坐标\r\n  x -= window.screenX;\r\n  y -= window.screenY;\r\n  const point = { x, y };\r\n  //point是鼠标到浏览器窗口左上角位置，所以为了获得到视口左上角位置需要进行如下处理\r\n  point.x -= window.outerWidth - window.innerWidth;\r\n  if (point.x < 0) point.x = x;\r\n  point.y -= window.outerHeight - window.innerHeight;\r\n  if (point.y < 0) point.y = y;\r\n  agent.showTranslation({\r\n    translatedData: data.translatedData,\r\n    point,\r\n  });\r\n}\r\n/**\r\n * 处理选中文本的翻译，\r\n * 其特别之处在于其只对英文起反应，\r\n * 且过滤掉输入框内的拖蓝查询\r\n */\r\nasync function translateAndShowText(text: string) {\r\n  //如果正在展示翻译，则不能够通过selection进行翻译。\r\n  //这主要是避免热键查询的情况\r\n  if (agent.isVisible()) return;\r\n\r\n  //过滤掉非英文\r\n  const result = validateText(text);\r\n  if (!result) return;\r\n\r\n  const translatedData = await postBackend(Command.TranslateText, text);\r\n  const point = getClientPoint();\r\n  agent.showTranslation({ translatedData, point });\r\n}\r\n/**\r\n * 用于处理searchBox传递的数据，\r\n * 其特别之处在于其会对中文进行查询\r\n */\r\nasync function translateAndShowSearchText(text: string) {\r\n  const translatedData = await postBackend(Command.TranslateText, text);\r\n  const point = getClientPoint();\r\n  agent.showTranslation({ translatedData, point });\r\n}\r\n/**\r\n * 用于处理shower传递的翻译，\r\n * 其特别之处在于iframe不会移动(point没有变化),只支持英文\r\n */\r\nasync function translateAndShowIframeText(text: string) {\r\n  //过滤掉非英文\r\n  const result = validateText(text);\r\n  if (!result) return;\r\n  const translatedData = await postBackend(Command.TranslateText, text);\r\n  agent.showTranslation({ translatedData });\r\n}\r\n\r\nfunction openSelectionAndHotKeyListener() {\r\n  hotKeyListener.install();\r\n  selectionListener.install();\r\n}\r\n\r\nfunction closeSelectionAndHotKeyListener() {\r\n  hotKeyListener.uninstall();\r\n  selectionListener.uninstall();\r\n}\r\n\r\ngetStorageByObject({\r\n  switchHotkeyAndSelectionListener(value) {\r\n    return value\r\n      ? openSelectionAndHotKeyListener()\r\n      : closeSelectionAndHotKeyListener();\r\n  },\r\n  hotKey(value) {\r\n    return hotKeyListener.updateHotKey(value);\r\n  },\r\n  switchStrengthenSelectionByPressedCtrl(value) {\r\n    return selectionListener.switchStrengthenSelectionByPressedCtrl(value);\r\n  },\r\n});\r\n\r\nonStorageChange({\r\n  switchHotkeyAndSelectionListener(_, value) {\r\n    return value\r\n      ? openSelectionAndHotKeyListener()\r\n      : closeSelectionAndHotKeyListener();\r\n  },\r\n  hotKey(_, value) {\r\n    return hotKeyListener.updateHotKey(value);\r\n  },\r\n  switchStrengthenSelectionByPressedCtrl(_, value) {\r\n    return selectionListener.switchStrengthenSelectionByPressedCtrl(value);\r\n  },\r\n});\r\n\r\n//监听后端传递的指令并进行处理\r\nonMessage(async ({ command, data }) => {\r\n  if (command === Command.ShowIframe) agent.showUI(getClientPoint());\r\n  if (command === Command.OpenSearchBox) searchBox.openSearchBox();\r\n  if (command === Command.ShowInjectTranslation)\r\n    showInjectScriptTranslationText(data);\r\n});\r\n"],"names":["Command","WORD_FIELDS_MAP","PHRASE_FIELDS_MAP","COMMON_CONFIG_MAP","SENTENCE_FIELDS_MAP","ANKI_CONNECTION_MAP","DEFAULT_ANKI_CONNECTION_URL","definition","word","translation","part_of_speech","definition_audio","am","en","am_audio","en_audio","star_amount","example_audio","example_sentence","example_sentence_translation","phrase","phrase_audio","translations","example_audio_1","example_audio_2","example_audio_3","example_sentence_1","example_sentence_2","example_sentence_3","example_sentence_translation_1","example_sentence_translation_2","example_sentence_translation_3","sentence","sentence_audio","sentence_translation","deckName","modelName","tags","ankiConnectionMethod","ankiConnectionURL","Object","freeze","Messenger","getURL","getStorageByArray","setStorage","openSelection","hiddenChinese","Agent","messenger","install","document","body","append","translationWrapper","hiddenTranslationView","uninstall","remove","mask","isConnected","postMessage","PauseAudio","configMask","translationContainer","style","visibility","configContainer","classList","add","data","translatedData","point","ShowTranslation","showUI","rect","getBoundingClientRect","width","height","left","x","top","y","clientWidth","documentElement","clientHeight","Math","min","max","cssText","self","window","onMessage","createTranslationView","iframe","wrapper","container","backButton","configButton","forwardButton","addEventListener","contentWindow","addTarget","HistoryIndex","index","head","tail","event","input","target","isInputElement","name","isOpen","checked","OpenSelection","hidden","HiddenChinese","createMask","prepend","BackHistory","ForwardHistory","moveMask","count","clientX","clientY","relativeX","relativeY","mouseMoveHandle","mouseUpHandle","removeEventListener","item","src","onClickToggle","ele","Element","tagName","createElement","setProperty","shadowRoot","attachShadow","mode","innerHTML","header","textContent","setBadgeText","details","callback","chrome","browserAction","onCommand","handlerObject","commands","addListener","command","handler","StrictOnCommand","runtime","getManifest","Error","commandNames","keys","forEach","addContextMenuItem","createProperties","contextMenus","create","onContextMenuClick","onClicked","getStorageByObject","onStorageChange","executeScript","postFrontend","postBackend","openOptionsPage","TabPanelName","Promise","resolve","sendMessage","response","message","sender","_sendResponse","called","sendResponse","then","pick","defaultStorage","switchHotkeyAndSelectionListener","hotKey","checkedTabPanel","Home","switchStrengthenSelectionByPressedCtrl","wordConfig","phraseConfig","sentenceConfig","checkWordDuplicate","checkPhraseDuplicate","checkSentenceDuplicate","handlersIsArray","handlers","Array","isArray","getStorage","storageKeys","storage","local","get","key","cacheValue","names","listener","changes","oldValue","newValue","onChanged","removeListener","partialStorage","set","tabs","query","active","tab","id","CursorListener","clientPoint","screenPoint","onMouseMove","screenY","screenX","getSelectionText","getRangeFromPoint","isContentEditable","isSearchContainer","UserSelectHandler","HotKeyListener","translateAndDisplayText","getPoint","onKeyDown","restore","focusNode","activeElement","autoSelectText","selectedText","letter","checkout","test","range","extendRange","selection","getSelection","commonAncestorContainer","parentElement","modify","removeAllRanges","addRange","textNode","startContainer","isText","limit_left","limit_right","length","text","startOffset","endOffset","validate","newRange","Range","setStart","setEnd","node","nodeType","attachSymbolToSearchContainer","SearchBox","closeSearchBox","createSearchBar","openSearchBox","FORM_ID","INPUT_ID","BUTTON_ID","shadow","form","getElementById","button","preventDefault","value","trim","display","focus","select","SelectionListener","onMouseDown","onMouseUp","enableCtrl","onSelectionChange","once","selectionChanged","ctrlKey","USER_SELECT","Map","element","modifiedHTMLElements","has","userSelectValue","getPropertyValue","userSelectPriority","getPropertyPriority","priority","clear","caretRangeFromPoint","caretPosition","caretPositionFromPoint","offsetNode","offset","createRange","toString","includes","HTMLElement","SEARCH_CONTAINER_ID","ATTRIBUTE_NAME","getAttribute","setAttribute","warning","invariant","uniqueId","CALLBACK","options","handleMessage","callbacks","source","callbackName","fn","bind","push","filter","cond","console","warn","e","validateText","extractEntry","amount","match","reduce","search","cursorListener","getClientPoint","searchBox","translateAndShowSearchText","selectionListener","translateAndShowText","hotKeyListener","agent","AddNote","RelearnNote","TranslateText","translateAndShowIframeText","showInjectScriptTranslationText","outerWidth","innerWidth","outerHeight","innerHeight","showTranslation","isVisible","result","openSelectionAndHotKeyListener","closeSelectionAndHotKeyListener","updateHotKey","_","ShowIframe","OpenSearchBox","ShowInjectTranslation"],"sourceRoot":""}